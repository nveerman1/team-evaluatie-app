# =============================================================================
# Fail2ban Jail Configuration for Nginx
# =============================================================================
#
# INSTALLATION:
# 1. Copy this file to /etc/fail2ban/jail.d/nginx-tea.conf on the VPS
# 2. Ensure nginx logs are accessible at /var/lib/docker/volumes/ops_nginx-logs/_data/
# 3. Restart fail2ban: sudo systemctl restart fail2ban
# 4. Verify: sudo fail2ban-client status nginx-tea-auth
#
# This configuration protects against:
# - Brute force authentication attempts (401/403 errors)
# - 404 scanning attacks (path traversal, vulnerability scanning)
# - Suspicious request patterns (common exploit attempts)
#
# =============================================================================

[nginx-tea-auth]
enabled = true
port = http,https
filter = nginx-tea-auth
logpath = /var/lib/docker/volumes/ops_nginx-logs/_data/access.log
maxretry = 5
findtime = 300
bantime = 3600
action = iptables-multiport[name=nginx-tea-auth, port="http,https"]

[nginx-tea-404]
enabled = true
port = http,https
filter = nginx-tea-404
logpath = /var/lib/docker/volumes/ops_nginx-logs/_data/access.log
maxretry = 10
findtime = 60
bantime = 1800
action = iptables-multiport[name=nginx-tea-404, port="http,https"]

[nginx-tea-exploits]
enabled = true
port = http,https
filter = nginx-tea-exploits
logpath = /var/lib/docker/volumes/ops_nginx-logs/_data/access.log
maxretry = 3
findtime = 300
bantime = 7200
action = iptables-multiport[name=nginx-tea-exploits, port="http,https"]

[nginx-tea-dos]
enabled = true
port = http,https
filter = nginx-tea-dos
logpath = /var/lib/docker/volumes/ops_nginx-logs/_data/access.log
maxretry = 100
findtime = 60
bantime = 600
action = iptables-multiport[name=nginx-tea-dos, port="http,https"]
