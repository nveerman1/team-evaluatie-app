"""Initial migration

Revision ID: 118f1aa65586
Revises: 
Create Date: 2026-01-25 21:51:21.132977

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = '118f1aa65586'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('competency_categories',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('color', sa.String(length=20), nullable=True),
    sa.Column('icon', sa.String(length=100), nullable=True),
    sa.Column('order_index', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('school_id', 'name', name='uq_competency_category_name_per_school')
    )
    op.create_index(op.f('ix_competency_categories_id'), 'competency_categories', ['id'], unique=False)
    op.create_index(op.f('ix_competency_categories_school_id'), 'competency_categories', ['school_id'], unique=False)
    op.create_index('ix_competency_category_school', 'competency_categories', ['school_id'], unique=False)
    op.create_table('rubrics',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('scale_min', sa.SmallInteger(), nullable=False),
    sa.Column('scale_max', sa.SmallInteger(), nullable=False),
    sa.Column('scope', sa.String(length=20), nullable=False),
    sa.Column('target_level', sa.String(length=20), nullable=True),
    sa.Column('metadata_json', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_rubric_school_scope', 'rubrics', ['school_id', 'scope'], unique=False)
    op.create_index(op.f('ix_rubrics_id'), 'rubrics', ['id'], unique=False)
    op.create_index(op.f('ix_rubrics_school_id'), 'rubrics', ['school_id'], unique=False)
    op.create_table('schools',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_index(op.f('ix_schools_id'), 'schools', ['id'], unique=False)
    op.create_table('academic_years',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('label', sa.String(length=50), nullable=False),
    sa.Column('start_date', sa.Date(), nullable=False),
    sa.Column('end_date', sa.Date(), nullable=False),
    sa.Column('is_archived', sa.Boolean(), nullable=False),
    sa.Column('archived_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('school_id', 'label', name='uq_academic_year_label_per_school')
    )
    op.create_index('ix_academic_year_school', 'academic_years', ['school_id'], unique=False)
    op.create_index(op.f('ix_academic_years_id'), 'academic_years', ['id'], unique=False)
    op.create_index(op.f('ix_academic_years_school_id'), 'academic_years', ['school_id'], unique=False)
    op.create_table('clients',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('organization', sa.String(length=200), nullable=False),
    sa.Column('contact_name', sa.String(length=200), nullable=True),
    sa.Column('email', sa.String(length=320), nullable=True),
    sa.Column('phone', sa.String(length=50), nullable=True),
    sa.Column('level', sa.String(length=50), nullable=True),
    sa.Column('sector', sa.String(length=100), nullable=True),
    sa.Column('tags', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_client_organization', 'clients', ['organization'], unique=False)
    op.create_index('ix_client_school_active', 'clients', ['school_id', 'active'], unique=False)
    op.create_index(op.f('ix_clients_id'), 'clients', ['id'], unique=False)
    op.create_index(op.f('ix_clients_school_id'), 'clients', ['school_id'], unique=False)
    op.create_table('external_evaluators',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('email', sa.String(length=320), nullable=False),
    sa.Column('organisation', sa.String(length=200), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_external_evaluator_email', 'external_evaluators', ['email'], unique=False)
    op.create_index('ix_external_evaluator_school_email', 'external_evaluators', ['school_id', 'email'], unique=False)
    op.create_index(op.f('ix_external_evaluators_id'), 'external_evaluators', ['id'], unique=False)
    op.create_index(op.f('ix_external_evaluators_school_id'), 'external_evaluators', ['school_id'], unique=False)
    op.create_table('subjects',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('code', sa.String(length=50), nullable=False),
    sa.Column('color', sa.String(length=20), nullable=True),
    sa.Column('icon', sa.String(length=100), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('school_id', 'code', name='uq_subject_code_per_school')
    )
    op.create_index('ix_subject_school_active', 'subjects', ['school_id', 'is_active'], unique=False)
    op.create_index(op.f('ix_subjects_id'), 'subjects', ['id'], unique=False)
    op.create_index(op.f('ix_subjects_school_id'), 'subjects', ['school_id'], unique=False)
    op.create_table('users',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('email', sa.String(length=320), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('role', sa.String(length=20), nullable=False),
    sa.Column('auth_provider', sa.String(length=50), nullable=True),
    sa.Column('password_hash', sa.String(length=255), nullable=True),
    sa.Column('archived', sa.Boolean(), nullable=False),
    sa.Column('class_name', sa.String(length=50), nullable=True),
    sa.Column('team_number', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('school_id', 'email', name='uq_user_email_per_school')
    )
    op.create_index('ix_user_role_school', 'users', ['school_id', 'role'], unique=False)
    op.create_index(op.f('ix_users_class_name'), 'users', ['class_name'], unique=False)
    op.create_index(op.f('ix_users_id'), 'users', ['id'], unique=False)
    op.create_index(op.f('ix_users_school_id'), 'users', ['school_id'], unique=False)
    op.create_index(op.f('ix_users_team_number'), 'users', ['team_number'], unique=False)
    op.create_table('attendance_aggregates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('total_school_seconds', sa.Integer(), nullable=False),
    sa.Column('total_external_approved_seconds', sa.Integer(), nullable=False),
    sa.Column('lesson_blocks', sa.Numeric(precision=10, scale=1), nullable=False),
    sa.Column('last_recomputed_at', sa.DateTime(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_attendance_aggregates_id'), 'attendance_aggregates', ['id'], unique=False)
    op.create_index('ix_attendance_aggregates_user_id', 'attendance_aggregates', ['user_id'], unique=False)
    op.create_table('audit_logs',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('user_email', sa.String(length=320), nullable=True),
    sa.Column('action', sa.String(length=100), nullable=False),
    sa.Column('entity_type', sa.String(length=100), nullable=False),
    sa.Column('entity_id', sa.Integer(), nullable=True),
    sa.Column('details', sa.JSON(), nullable=False),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.String(length=500), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_audit_log_action', 'audit_logs', ['action'], unique=False)
    op.create_index('ix_audit_log_created', 'audit_logs', ['created_at'], unique=False)
    op.create_index('ix_audit_log_entity', 'audit_logs', ['entity_type', 'entity_id'], unique=False)
    op.create_index('ix_audit_log_school', 'audit_logs', ['school_id'], unique=False)
    op.create_index('ix_audit_log_user', 'audit_logs', ['user_id'], unique=False)
    op.create_index(op.f('ix_audit_logs_id'), 'audit_logs', ['id'], unique=False)
    op.create_index(op.f('ix_audit_logs_school_id'), 'audit_logs', ['school_id'], unique=False)
    op.create_table('classes',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('academic_year_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=50), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['academic_year_id'], ['academic_years.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('school_id', 'academic_year_id', 'name', name='uq_class_name_per_year')
    )
    op.create_index('ix_class_academic_year', 'classes', ['academic_year_id'], unique=False)
    op.create_index('ix_class_school', 'classes', ['school_id'], unique=False)
    op.create_index(op.f('ix_classes_academic_year_id'), 'classes', ['academic_year_id'], unique=False)
    op.create_index(op.f('ix_classes_id'), 'classes', ['id'], unique=False)
    op.create_index(op.f('ix_classes_school_id'), 'classes', ['school_id'], unique=False)
    op.create_table('client_logs',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('client_id', sa.Integer(), nullable=False),
    sa.Column('author_id', sa.Integer(), nullable=False),
    sa.Column('log_type', sa.String(length=50), nullable=False),
    sa.Column('text', sa.Text(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['author_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_client_log_client', 'client_logs', ['client_id'], unique=False)
    op.create_index('ix_client_log_created_at', 'client_logs', ['created_at'], unique=False)
    op.create_index(op.f('ix_client_logs_author_id'), 'client_logs', ['author_id'], unique=False)
    op.create_index(op.f('ix_client_logs_client_id'), 'client_logs', ['client_id'], unique=False)
    op.create_index(op.f('ix_client_logs_id'), 'client_logs', ['id'], unique=False)
    op.create_table('competency_templates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('subject_id', sa.Integer(), nullable=True),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['subject_id'], ['subjects.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_competency_template_school', 'competency_templates', ['school_id'], unique=False)
    op.create_index('ix_competency_template_subject', 'competency_templates', ['subject_id'], unique=False)
    op.create_index(op.f('ix_competency_templates_id'), 'competency_templates', ['id'], unique=False)
    op.create_index(op.f('ix_competency_templates_school_id'), 'competency_templates', ['school_id'], unique=False)
    op.create_index(op.f('ix_competency_templates_subject_id'), 'competency_templates', ['subject_id'], unique=False)
    op.create_table('courses',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('subject_id', sa.Integer(), nullable=True),
    sa.Column('academic_year_id', sa.Integer(), nullable=True),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('code', sa.String(length=50), nullable=True),
    sa.Column('period', sa.String(length=50), nullable=True),
    sa.Column('level', sa.String(length=50), nullable=True),
    sa.Column('year', sa.Integer(), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['academic_year_id'], ['academic_years.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['subject_id'], ['subjects.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('school_id', 'code', name='uq_course_code_per_school'),
    sa.UniqueConstraint('school_id', 'name', 'period', name='uq_course_name_period')
    )
    op.create_index('ix_course_academic_year', 'courses', ['academic_year_id'], unique=False)
    op.create_index('ix_course_school_active', 'courses', ['school_id', 'is_active'], unique=False)
    op.create_index('ix_course_subject', 'courses', ['subject_id'], unique=False)
    op.create_index(op.f('ix_courses_academic_year_id'), 'courses', ['academic_year_id'], unique=False)
    op.create_index(op.f('ix_courses_id'), 'courses', ['id'], unique=False)
    op.create_index(op.f('ix_courses_school_id'), 'courses', ['school_id'], unique=False)
    op.create_index(op.f('ix_courses_subject_id'), 'courses', ['subject_id'], unique=False)
    op.create_table('mail_templates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('subject_id', sa.Integer(), nullable=True),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('type', sa.String(length=100), nullable=False),
    sa.Column('subject', sa.String(length=500), nullable=False),
    sa.Column('body', sa.Text(), nullable=False),
    sa.Column('variables_allowed', sa.JSON(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['subject_id'], ['subjects.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_mail_template_active', 'mail_templates', ['is_active'], unique=False)
    op.create_index('ix_mail_template_school', 'mail_templates', ['school_id'], unique=False)
    op.create_index('ix_mail_template_subject', 'mail_templates', ['subject_id'], unique=False)
    op.create_index('ix_mail_template_type', 'mail_templates', ['type'], unique=False)
    op.create_index(op.f('ix_mail_templates_id'), 'mail_templates', ['id'], unique=False)
    op.create_index(op.f('ix_mail_templates_school_id'), 'mail_templates', ['school_id'], unique=False)
    op.create_index(op.f('ix_mail_templates_subject_id'), 'mail_templates', ['subject_id'], unique=False)
    op.create_table('notifications',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('recipient_user_id', sa.Integer(), nullable=False),
    sa.Column('type', sa.String(length=50), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('body', sa.Text(), nullable=True),
    sa.Column('link', sa.String(length=500), nullable=True),
    sa.Column('read_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['recipient_user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_notifications_created', 'notifications', ['created_at'], unique=False)
    op.create_index(op.f('ix_notifications_id'), 'notifications', ['id'], unique=False)
    op.create_index('ix_notifications_recipient', 'notifications', ['recipient_user_id', 'read_at'], unique=False)
    op.create_index(op.f('ix_notifications_recipient_user_id'), 'notifications', ['recipient_user_id'], unique=False)
    op.create_index('ix_notifications_school', 'notifications', ['school_id'], unique=False)
    op.create_index(op.f('ix_notifications_school_id'), 'notifications', ['school_id'], unique=False)
    op.create_table('peer_evaluation_criterion_templates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('subject_id', sa.Integer(), nullable=False),
    sa.Column('omza_category', sa.String(length=50), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('target_level', sa.String(length=20), nullable=True),
    sa.Column('level_descriptors', sa.JSON(), nullable=False),
    sa.Column('learning_objective_ids', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['subject_id'], ['subjects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_peer_criterion_template_category', 'peer_evaluation_criterion_templates', ['omza_category'], unique=False)
    op.create_index('ix_peer_criterion_template_school', 'peer_evaluation_criterion_templates', ['school_id'], unique=False)
    op.create_index('ix_peer_criterion_template_subject', 'peer_evaluation_criterion_templates', ['subject_id'], unique=False)
    op.create_index('ix_peer_criterion_template_target_level', 'peer_evaluation_criterion_templates', ['target_level'], unique=False)
    op.create_index(op.f('ix_peer_evaluation_criterion_templates_id'), 'peer_evaluation_criterion_templates', ['id'], unique=False)
    op.create_index(op.f('ix_peer_evaluation_criterion_templates_school_id'), 'peer_evaluation_criterion_templates', ['school_id'], unique=False)
    op.create_index(op.f('ix_peer_evaluation_criterion_templates_subject_id'), 'peer_evaluation_criterion_templates', ['subject_id'], unique=False)
    op.create_index(op.f('ix_peer_evaluation_criterion_templates_target_level'), 'peer_evaluation_criterion_templates', ['target_level'], unique=False)
    op.create_table('project_assessment_criterion_templates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('subject_id', sa.Integer(), nullable=False),
    sa.Column('category', sa.String(length=50), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('target_level', sa.String(length=20), nullable=True),
    sa.Column('level_descriptors', sa.JSON(), nullable=False),
    sa.Column('learning_objective_ids', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['subject_id'], ['subjects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_project_assessment_criterion_template_category', 'project_assessment_criterion_templates', ['category'], unique=False)
    op.create_index('ix_project_assessment_criterion_template_school', 'project_assessment_criterion_templates', ['school_id'], unique=False)
    op.create_index('ix_project_assessment_criterion_template_subject', 'project_assessment_criterion_templates', ['subject_id'], unique=False)
    op.create_index('ix_project_assessment_criterion_template_target_level', 'project_assessment_criterion_templates', ['target_level'], unique=False)
    op.create_index(op.f('ix_project_assessment_criterion_templates_id'), 'project_assessment_criterion_templates', ['id'], unique=False)
    op.create_index(op.f('ix_project_assessment_criterion_templates_school_id'), 'project_assessment_criterion_templates', ['school_id'], unique=False)
    op.create_index(op.f('ix_project_assessment_criterion_templates_subject_id'), 'project_assessment_criterion_templates', ['subject_id'], unique=False)
    op.create_index(op.f('ix_project_assessment_criterion_templates_target_level'), 'project_assessment_criterion_templates', ['target_level'], unique=False)
    op.create_table('project_rubric_templates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('subject_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('level', sa.String(length=50), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['subject_id'], ['subjects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_project_rubric_template_level', 'project_rubric_templates', ['level'], unique=False)
    op.create_index('ix_project_rubric_template_school', 'project_rubric_templates', ['school_id'], unique=False)
    op.create_index('ix_project_rubric_template_subject', 'project_rubric_templates', ['subject_id'], unique=False)
    op.create_index(op.f('ix_project_rubric_templates_id'), 'project_rubric_templates', ['id'], unique=False)
    op.create_index(op.f('ix_project_rubric_templates_school_id'), 'project_rubric_templates', ['school_id'], unique=False)
    op.create_index(op.f('ix_project_rubric_templates_subject_id'), 'project_rubric_templates', ['subject_id'], unique=False)
    op.create_table('rfid_cards',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('uid', sa.String(length=50), nullable=False),
    sa.Column('label', sa.String(length=100), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('uid')
    )
    op.create_index(op.f('ix_rfid_cards_id'), 'rfid_cards', ['id'], unique=False)
    op.create_index('ix_rfid_cards_uid_active', 'rfid_cards', ['uid'], unique=False, postgresql_where=sa.text('is_active = true'))
    op.create_index('ix_rfid_cards_user_id', 'rfid_cards', ['user_id'], unique=False)
    op.create_table('scheduled_jobs',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('task_type', sa.String(length=100), nullable=False),
    sa.Column('queue_name', sa.String(length=100), nullable=False),
    sa.Column('cron_expression', sa.String(length=100), nullable=False),
    sa.Column('task_params', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('enabled', sa.Boolean(), nullable=False),
    sa.Column('last_run_at', sa.DateTime(), nullable=True),
    sa.Column('next_run_at', sa.DateTime(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_scheduled_jobs_enabled', 'scheduled_jobs', ['enabled'], unique=False)
    op.create_index(op.f('ix_scheduled_jobs_id'), 'scheduled_jobs', ['id'], unique=False)
    op.create_index('ix_scheduled_jobs_next_run', 'scheduled_jobs', ['next_run_at'], unique=False)
    op.create_index(op.f('ix_scheduled_jobs_school_id'), 'scheduled_jobs', ['school_id'], unique=False)
    op.create_table('standard_remarks',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('subject_id', sa.Integer(), nullable=True),
    sa.Column('type', sa.String(length=50), nullable=False),
    sa.Column('category', sa.String(length=50), nullable=False),
    sa.Column('text', sa.Text(), nullable=False),
    sa.Column('order', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['subject_id'], ['subjects.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_standard_remark_category', 'standard_remarks', ['category'], unique=False)
    op.create_index('ix_standard_remark_school', 'standard_remarks', ['school_id'], unique=False)
    op.create_index('ix_standard_remark_subject', 'standard_remarks', ['subject_id'], unique=False)
    op.create_index('ix_standard_remark_type', 'standard_remarks', ['type'], unique=False)
    op.create_index(op.f('ix_standard_remarks_id'), 'standard_remarks', ['id'], unique=False)
    op.create_index(op.f('ix_standard_remarks_school_id'), 'standard_remarks', ['school_id'], unique=False)
    op.create_index(op.f('ix_standard_remarks_subject_id'), 'standard_remarks', ['subject_id'], unique=False)
    op.create_table('template_tags',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('subject_id', sa.Integer(), nullable=True),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('color', sa.String(length=20), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['subject_id'], ['subjects.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('school_id', 'name', name='uq_template_tag_name_per_school')
    )
    op.create_index('ix_template_tag_school', 'template_tags', ['school_id'], unique=False)
    op.create_index('ix_template_tag_subject', 'template_tags', ['subject_id'], unique=False)
    op.create_index(op.f('ix_template_tags_id'), 'template_tags', ['id'], unique=False)
    op.create_index(op.f('ix_template_tags_school_id'), 'template_tags', ['school_id'], unique=False)
    op.create_index(op.f('ix_template_tags_subject_id'), 'template_tags', ['subject_id'], unique=False)
    op.create_table('competencies',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('category_id', sa.Integer(), nullable=True),
    sa.Column('subject_id', sa.Integer(), nullable=True),
    sa.Column('teacher_id', sa.Integer(), nullable=True),
    sa.Column('course_id', sa.Integer(), nullable=True),
    sa.Column('is_template', sa.Boolean(), nullable=False),
    sa.Column('phase', sa.String(length=20), nullable=True),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('category', sa.String(length=100), nullable=True),
    sa.Column('order', sa.Integer(), nullable=False),
    sa.Column('active', sa.Boolean(), nullable=False),
    sa.Column('scale_min', sa.SmallInteger(), nullable=False),
    sa.Column('scale_max', sa.SmallInteger(), nullable=False),
    sa.Column('scale_labels', sa.JSON(), nullable=False),
    sa.Column('metadata_json', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['category_id'], ['competency_categories.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['subject_id'], ['subjects.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['teacher_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('school_id', 'name', 'teacher_id', name='uq_competency_name_per_school_teacher')
    )
    op.create_index(op.f('ix_competencies_category_id'), 'competencies', ['category_id'], unique=False)
    op.create_index(op.f('ix_competencies_course_id'), 'competencies', ['course_id'], unique=False)
    op.create_index(op.f('ix_competencies_id'), 'competencies', ['id'], unique=False)
    op.create_index(op.f('ix_competencies_phase'), 'competencies', ['phase'], unique=False)
    op.create_index(op.f('ix_competencies_school_id'), 'competencies', ['school_id'], unique=False)
    op.create_index(op.f('ix_competencies_subject_id'), 'competencies', ['subject_id'], unique=False)
    op.create_index(op.f('ix_competencies_teacher_id'), 'competencies', ['teacher_id'], unique=False)
    op.create_index('ix_competency_category_id', 'competencies', ['category_id'], unique=False)
    op.create_index('ix_competency_course', 'competencies', ['course_id'], unique=False)
    op.create_index('ix_competency_is_template', 'competencies', ['school_id', 'is_template'], unique=False)
    op.create_index('ix_competency_school', 'competencies', ['school_id'], unique=False)
    op.create_index('ix_competency_subject', 'competencies', ['subject_id'], unique=False)
    op.create_index('ix_competency_teacher', 'competencies', ['teacher_id'], unique=False)
    op.create_table('competency_level_descriptor_templates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('competency_template_id', sa.Integer(), nullable=False),
    sa.Column('level', sa.String(length=50), nullable=False),
    sa.Column('behavior_description', sa.Text(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['competency_template_id'], ['competency_templates.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('competency_template_id', 'level', name='uq_competency_level_per_template')
    )
    op.create_index(op.f('ix_competency_level_descriptor_templates_competency_template_id'), 'competency_level_descriptor_templates', ['competency_template_id'], unique=False)
    op.create_index(op.f('ix_competency_level_descriptor_templates_id'), 'competency_level_descriptor_templates', ['id'], unique=False)
    op.create_index(op.f('ix_competency_level_descriptor_templates_school_id'), 'competency_level_descriptor_templates', ['school_id'], unique=False)
    op.create_index('ix_competency_level_template_competency', 'competency_level_descriptor_templates', ['competency_template_id'], unique=False)
    op.create_table('competency_reflection_question_templates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('competency_template_id', sa.Integer(), nullable=False),
    sa.Column('question_text', sa.Text(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['competency_template_id'], ['competency_templates.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_competency_reflection_question_templates_competency_template_id'), 'competency_reflection_question_templates', ['competency_template_id'], unique=False)
    op.create_index(op.f('ix_competency_reflection_question_templates_id'), 'competency_reflection_question_templates', ['id'], unique=False)
    op.create_index(op.f('ix_competency_reflection_question_templates_school_id'), 'competency_reflection_question_templates', ['school_id'], unique=False)
    op.create_index('ix_competency_reflection_template_competency', 'competency_reflection_question_templates', ['competency_template_id'], unique=False)
    op.create_table('competency_windows',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('class_names', sa.JSON(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=True),
    sa.Column('start_date', sa.DateTime(), nullable=True),
    sa.Column('end_date', sa.DateTime(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('require_self_score', sa.Boolean(), nullable=False),
    sa.Column('require_goal', sa.Boolean(), nullable=False),
    sa.Column('require_reflection', sa.Boolean(), nullable=False),
    sa.Column('settings', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_competency_window_school', 'competency_windows', ['school_id'], unique=False)
    op.create_index('ix_competency_window_status', 'competency_windows', ['school_id', 'status'], unique=False)
    op.create_index(op.f('ix_competency_windows_id'), 'competency_windows', ['id'], unique=False)
    op.create_index(op.f('ix_competency_windows_school_id'), 'competency_windows', ['school_id'], unique=False)
    op.create_table('course_enrollments',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=False),
    sa.Column('student_id', sa.Integer(), nullable=False),
    sa.Column('active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('course_id', 'student_id', name='uq_course_enrollment_once')
    )
    op.create_index('ix_course_enrollment_course', 'course_enrollments', ['course_id'], unique=False)
    op.create_index('ix_course_enrollment_student', 'course_enrollments', ['student_id'], unique=False)
    op.create_index(op.f('ix_course_enrollments_course_id'), 'course_enrollments', ['course_id'], unique=False)
    op.create_index(op.f('ix_course_enrollments_id'), 'course_enrollments', ['id'], unique=False)
    op.create_index(op.f('ix_course_enrollments_student_id'), 'course_enrollments', ['student_id'], unique=False)
    op.create_table('learning_objectives',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('subject_id', sa.Integer(), nullable=True),
    sa.Column('teacher_id', sa.Integer(), nullable=True),
    sa.Column('course_id', sa.Integer(), nullable=True),
    sa.Column('is_template', sa.Boolean(), nullable=False),
    sa.Column('domain', sa.String(length=50), nullable=True),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('order', sa.Integer(), nullable=False),
    sa.Column('phase', sa.String(length=20), nullable=True),
    sa.Column('metadata_json', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['subject_id'], ['subjects.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['teacher_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_learning_objective_course', 'learning_objectives', ['course_id'], unique=False)
    op.create_index('ix_learning_objective_domain', 'learning_objectives', ['school_id', 'domain'], unique=False)
    op.create_index('ix_learning_objective_is_template', 'learning_objectives', ['school_id', 'is_template'], unique=False)
    op.create_index('ix_learning_objective_phase', 'learning_objectives', ['school_id', 'phase'], unique=False)
    op.create_index('ix_learning_objective_school', 'learning_objectives', ['school_id'], unique=False)
    op.create_index('ix_learning_objective_subject', 'learning_objectives', ['subject_id'], unique=False)
    op.create_index('ix_learning_objective_teacher', 'learning_objectives', ['teacher_id'], unique=False)
    op.create_index(op.f('ix_learning_objectives_course_id'), 'learning_objectives', ['course_id'], unique=False)
    op.create_index(op.f('ix_learning_objectives_id'), 'learning_objectives', ['id'], unique=False)
    op.create_index(op.f('ix_learning_objectives_school_id'), 'learning_objectives', ['school_id'], unique=False)
    op.create_index(op.f('ix_learning_objectives_subject_id'), 'learning_objectives', ['subject_id'], unique=False)
    op.create_index(op.f('ix_learning_objectives_teacher_id'), 'learning_objectives', ['teacher_id'], unique=False)
    op.create_table('project_rubric_criterion_templates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('rubric_template_id', sa.Integer(), nullable=False),
    sa.Column('category', sa.String(length=100), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('weight', sa.Float(), nullable=False),
    sa.Column('level_descriptors', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['rubric_template_id'], ['project_rubric_templates.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_project_criterion_template_category', 'project_rubric_criterion_templates', ['category'], unique=False)
    op.create_index('ix_project_criterion_template_rubric', 'project_rubric_criterion_templates', ['rubric_template_id'], unique=False)
    op.create_index(op.f('ix_project_rubric_criterion_templates_id'), 'project_rubric_criterion_templates', ['id'], unique=False)
    op.create_index(op.f('ix_project_rubric_criterion_templates_rubric_template_id'), 'project_rubric_criterion_templates', ['rubric_template_id'], unique=False)
    op.create_index(op.f('ix_project_rubric_criterion_templates_school_id'), 'project_rubric_criterion_templates', ['school_id'], unique=False)
    op.create_table('projects',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=True),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('slug', sa.String(length=100), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('class_name', sa.String(length=50), nullable=True),
    sa.Column('period', sa.String(length=10), nullable=True),
    sa.Column('start_date', sa.Date(), nullable=True),
    sa.Column('end_date', sa.Date(), nullable=True),
    sa.Column('status', sa.String(length=30), nullable=False),
    sa.Column('created_by_id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_project_course', 'projects', ['course_id'], unique=False)
    op.create_index('ix_project_course_period', 'projects', ['course_id', 'period'], unique=False)
    op.create_index('ix_project_school', 'projects', ['school_id'], unique=False)
    op.create_index('ix_project_school_course', 'projects', ['school_id', 'course_id'], unique=False)
    op.create_index('ix_project_status', 'projects', ['status'], unique=False)
    op.create_index(op.f('ix_projects_course_id'), 'projects', ['course_id'], unique=False)
    op.create_index(op.f('ix_projects_id'), 'projects', ['id'], unique=False)
    op.create_index(op.f('ix_projects_school_id'), 'projects', ['school_id'], unique=False)
    op.create_table('student_class_memberships',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('student_id', sa.Integer(), nullable=False),
    sa.Column('class_id', sa.Integer(), nullable=False),
    sa.Column('academic_year_id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['academic_year_id'], ['academic_years.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['class_id'], ['classes.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('student_id', 'academic_year_id', name='uq_student_one_class_per_year')
    )
    op.create_index('ix_student_class_membership_academic_year', 'student_class_memberships', ['academic_year_id'], unique=False)
    op.create_index('ix_student_class_membership_class', 'student_class_memberships', ['class_id'], unique=False)
    op.create_index('ix_student_class_membership_student', 'student_class_memberships', ['student_id'], unique=False)
    op.create_index(op.f('ix_student_class_memberships_academic_year_id'), 'student_class_memberships', ['academic_year_id'], unique=False)
    op.create_index(op.f('ix_student_class_memberships_class_id'), 'student_class_memberships', ['class_id'], unique=False)
    op.create_index(op.f('ix_student_class_memberships_id'), 'student_class_memberships', ['id'], unique=False)
    op.create_index(op.f('ix_student_class_memberships_student_id'), 'student_class_memberships', ['student_id'], unique=False)
    op.create_table('teacher_courses',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('teacher_id', sa.Integer(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=False),
    sa.Column('role', sa.String(length=50), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['teacher_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('teacher_id', 'course_id', name='uq_teacher_course_once')
    )
    op.create_index('ix_teacher_course_course', 'teacher_courses', ['course_id'], unique=False)
    op.create_index('ix_teacher_course_school', 'teacher_courses', ['school_id'], unique=False)
    op.create_index('ix_teacher_course_teacher', 'teacher_courses', ['teacher_id'], unique=False)
    op.create_index(op.f('ix_teacher_courses_id'), 'teacher_courses', ['id'], unique=False)
    op.create_index(op.f('ix_teacher_courses_school_id'), 'teacher_courses', ['school_id'], unique=False)
    op.create_table('template_tag_links',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('tag_id', sa.Integer(), nullable=False),
    sa.Column('target_type', sa.String(length=100), nullable=False),
    sa.Column('target_id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['tag_id'], ['template_tags.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('tag_id', 'target_type', 'target_id', name='uq_template_tag_link_once')
    )
    op.create_index('ix_template_tag_link_tag', 'template_tag_links', ['tag_id'], unique=False)
    op.create_index('ix_template_tag_link_target', 'template_tag_links', ['target_type', 'target_id'], unique=False)
    op.create_index(op.f('ix_template_tag_links_id'), 'template_tag_links', ['id'], unique=False)
    op.create_index(op.f('ix_template_tag_links_school_id'), 'template_tag_links', ['school_id'], unique=False)
    op.create_index(op.f('ix_template_tag_links_tag_id'), 'template_tag_links', ['tag_id'], unique=False)
    op.create_table('attendance_events',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=True),
    sa.Column('check_in', sa.DateTime(), nullable=False),
    sa.Column('check_out', sa.DateTime(), nullable=True),
    sa.Column('is_external', sa.Boolean(), nullable=False),
    sa.Column('location', sa.String(length=200), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('approval_status', sa.String(length=20), nullable=True),
    sa.Column('approved_by', sa.Integer(), nullable=True),
    sa.Column('approved_at', sa.DateTime(), nullable=True),
    sa.Column('source', sa.String(length=20), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.CheckConstraint("approval_status IN ('pending', 'approved', 'rejected') OR approval_status IS NULL", name='check_approval_status_values'),
    sa.CheckConstraint("source IN ('rfid', 'manual', 'import', 'api')", name='check_source_values'),
    sa.CheckConstraint('(is_external = false) OR (is_external = true AND location IS NOT NULL AND approval_status IS NOT NULL)', name='check_external_fields'),
    sa.CheckConstraint('check_out IS NULL OR check_out > check_in', name='check_valid_times'),
    sa.ForeignKeyConstraint(['approved_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_attendance_events_check_in', 'attendance_events', ['check_in'], unique=False)
    op.create_index('ix_attendance_events_external_pending', 'attendance_events', ['user_id', 'approval_status'], unique=False, postgresql_where=sa.text("is_external = true AND approval_status = 'pending'"))
    op.create_index(op.f('ix_attendance_events_id'), 'attendance_events', ['id'], unique=False)
    op.create_index('ix_attendance_events_open_sessions', 'attendance_events', ['user_id', 'check_in'], unique=False, postgresql_where=sa.text('check_out IS NULL'))
    op.create_index(op.f('ix_attendance_events_project_id'), 'attendance_events', ['project_id'], unique=False)
    op.create_index(op.f('ix_attendance_events_user_id'), 'attendance_events', ['user_id'], unique=False)
    op.create_table('client_project_links',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('client_id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=False),
    sa.Column('role', sa.String(length=50), nullable=False),
    sa.Column('start_date', sa.Date(), nullable=True),
    sa.Column('end_date', sa.Date(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('client_id', 'project_id', name='uq_client_project_once')
    )
    op.create_index('ix_client_project_client', 'client_project_links', ['client_id'], unique=False)
    op.create_index(op.f('ix_client_project_links_client_id'), 'client_project_links', ['client_id'], unique=False)
    op.create_index(op.f('ix_client_project_links_id'), 'client_project_links', ['id'], unique=False)
    op.create_index(op.f('ix_client_project_links_project_id'), 'client_project_links', ['project_id'], unique=False)
    op.create_index('ix_client_project_project', 'client_project_links', ['project_id'], unique=False)
    op.create_table('competency_external_invites',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('window_id', sa.Integer(), nullable=False),
    sa.Column('subject_user_id', sa.Integer(), nullable=False),
    sa.Column('invited_by_user_id', sa.Integer(), nullable=False),
    sa.Column('email', sa.String(length=320), nullable=False),
    sa.Column('external_name', sa.String(length=200), nullable=True),
    sa.Column('external_organization', sa.String(length=200), nullable=True),
    sa.Column('token_hash', sa.String(length=64), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('expires_at', sa.DateTime(), nullable=False),
    sa.Column('sent_at', sa.DateTime(), nullable=True),
    sa.Column('opened_at', sa.DateTime(), nullable=True),
    sa.Column('submitted_at', sa.DateTime(), nullable=True),
    sa.Column('revoked_at', sa.DateTime(), nullable=True),
    sa.Column('rubric_snapshot', sa.JSON(), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['invited_by_user_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['subject_user_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['window_id'], ['competency_windows.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_competency_external_invites_id'), 'competency_external_invites', ['id'], unique=False)
    op.create_index(op.f('ix_competency_external_invites_school_id'), 'competency_external_invites', ['school_id'], unique=False)
    op.create_index(op.f('ix_competency_external_invites_token_hash'), 'competency_external_invites', ['token_hash'], unique=True)
    op.create_index('ix_external_invite_status', 'competency_external_invites', ['status'], unique=False)
    op.create_index('ix_external_invite_subject', 'competency_external_invites', ['subject_user_id'], unique=False)
    op.create_index('ix_external_invite_window', 'competency_external_invites', ['window_id'], unique=False)
    op.create_index('ix_external_invite_window_subject', 'competency_external_invites', ['window_id', 'subject_user_id'], unique=False)
    op.create_table('competency_goals',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('window_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('competency_id', sa.Integer(), nullable=True),
    sa.Column('goal_text', sa.Text(), nullable=False),
    sa.Column('success_criteria', sa.Text(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('submitted_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['competency_id'], ['competencies.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['window_id'], ['competency_windows.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_competency_goal_window_user', 'competency_goals', ['window_id', 'user_id'], unique=False)
    op.create_index(op.f('ix_competency_goals_id'), 'competency_goals', ['id'], unique=False)
    op.create_index(op.f('ix_competency_goals_school_id'), 'competency_goals', ['school_id'], unique=False)
    op.create_table('competency_peer_labels',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('window_id', sa.Integer(), nullable=False),
    sa.Column('from_user_id', sa.Integer(), nullable=False),
    sa.Column('to_user_id', sa.Integer(), nullable=False),
    sa.Column('competency_id', sa.Integer(), nullable=False),
    sa.Column('sentiment', sa.String(length=20), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['competency_id'], ['competencies.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['from_user_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['to_user_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['window_id'], ['competency_windows.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_competency_peer_labels_id'), 'competency_peer_labels', ['id'], unique=False)
    op.create_index(op.f('ix_competency_peer_labels_school_id'), 'competency_peer_labels', ['school_id'], unique=False)
    op.create_index('ix_peer_label_competency', 'competency_peer_labels', ['competency_id'], unique=False)
    op.create_index('ix_peer_label_window_to', 'competency_peer_labels', ['window_id', 'to_user_id'], unique=False)
    op.create_table('competency_rubric_levels',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('competency_id', sa.Integer(), nullable=False),
    sa.Column('level', sa.SmallInteger(), nullable=False),
    sa.Column('label', sa.String(length=100), nullable=True),
    sa.Column('description', sa.Text(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['competency_id'], ['competencies.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('competency_id', 'level', name='uq_rubric_level_per_competency')
    )
    op.create_index(op.f('ix_competency_rubric_levels_id'), 'competency_rubric_levels', ['id'], unique=False)
    op.create_index(op.f('ix_competency_rubric_levels_school_id'), 'competency_rubric_levels', ['school_id'], unique=False)
    op.create_index('ix_rubric_level_competency', 'competency_rubric_levels', ['competency_id'], unique=False)
    op.create_table('competency_self_scores',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('window_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('competency_id', sa.Integer(), nullable=False),
    sa.Column('score', sa.SmallInteger(), nullable=False),
    sa.Column('example', sa.Text(), nullable=True),
    sa.Column('submitted_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['competency_id'], ['competencies.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['window_id'], ['competency_windows.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('window_id', 'user_id', 'competency_id', name='uq_self_score_once')
    )
    op.create_index(op.f('ix_competency_self_scores_id'), 'competency_self_scores', ['id'], unique=False)
    op.create_index(op.f('ix_competency_self_scores_school_id'), 'competency_self_scores', ['school_id'], unique=False)
    op.create_index('ix_self_score_window_user', 'competency_self_scores', ['window_id', 'user_id'], unique=False)
    op.create_table('competency_teacher_observations',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('window_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('competency_id', sa.Integer(), nullable=False),
    sa.Column('teacher_id', sa.Integer(), nullable=False),
    sa.Column('score', sa.SmallInteger(), nullable=False),
    sa.Column('comment', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['competency_id'], ['competencies.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['teacher_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['window_id'], ['competency_windows.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('window_id', 'user_id', 'competency_id', name='uq_teacher_obs_once')
    )
    op.create_index(op.f('ix_competency_teacher_observations_id'), 'competency_teacher_observations', ['id'], unique=False)
    op.create_index(op.f('ix_competency_teacher_observations_school_id'), 'competency_teacher_observations', ['school_id'], unique=False)
    op.create_index('ix_teacher_obs_window_user', 'competency_teacher_observations', ['window_id', 'user_id'], unique=False)
    op.create_table('project_assessments',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=False),
    sa.Column('rubric_id', sa.Integer(), nullable=False),
    sa.Column('teacher_id', sa.Integer(), nullable=True),
    sa.Column('external_evaluator_id', sa.Integer(), nullable=True),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('version', sa.String(length=50), nullable=True),
    sa.Column('status', sa.String(length=30), nullable=False),
    sa.Column('published_at', sa.DateTime(), nullable=True),
    sa.Column('closed_at', sa.DateTime(), nullable=True),
    sa.Column('role', sa.String(length=20), nullable=False),
    sa.Column('is_advisory', sa.Boolean(), nullable=False),
    sa.Column('metadata_json', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['external_evaluator_id'], ['external_evaluators.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['rubric_id'], ['rubrics.id'], ondelete='RESTRICT'),
    sa.ForeignKeyConstraint(['teacher_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_project_assessment_external', 'project_assessments', ['external_evaluator_id'], unique=False)
    op.create_index('ix_project_assessment_project_id', 'project_assessments', ['project_id'], unique=False)
    op.create_index('ix_project_assessment_project_status', 'project_assessments', ['project_id', 'status'], unique=False)
    op.create_index('ix_project_assessment_role', 'project_assessments', ['role'], unique=False)
    op.create_index('ix_project_assessment_status', 'project_assessments', ['status'], unique=False)
    op.create_index('ix_project_assessment_teacher', 'project_assessments', ['teacher_id'], unique=False)
    op.create_index(op.f('ix_project_assessments_id'), 'project_assessments', ['id'], unique=False)
    op.create_index(op.f('ix_project_assessments_project_id'), 'project_assessments', ['project_id'], unique=False)
    op.create_index(op.f('ix_project_assessments_school_id'), 'project_assessments', ['school_id'], unique=False)
    op.create_table('project_teams',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=False),
    sa.Column('display_name_at_time', sa.String(length=200), nullable=False),
    sa.Column('team_number', sa.Integer(), nullable=True),
    sa.Column('version', sa.Integer(), nullable=False),
    sa.Column('backfill_source', sa.String(length=50), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_project_team_project', 'project_teams', ['project_id'], unique=False)
    op.create_index(op.f('ix_project_teams_id'), 'project_teams', ['id'], unique=False)
    op.create_index(op.f('ix_project_teams_project_id'), 'project_teams', ['project_id'], unique=False)
    op.create_index('ix_project_teams_project_team_number', 'project_teams', ['project_id', 'team_number'], unique=False)
    op.create_index(op.f('ix_project_teams_school_id'), 'project_teams', ['school_id'], unique=False)
    op.create_index(op.f('ix_project_teams_team_number'), 'project_teams', ['team_number'], unique=False)
    op.create_table('rubric_criteria',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('rubric_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=150), nullable=False),
    sa.Column('weight', sa.Float(), nullable=False),
    sa.Column('descriptors', sa.JSON(), nullable=False),
    sa.Column('category', sa.String(length=100), nullable=True),
    sa.Column('order', sa.Integer(), nullable=True),
    sa.Column('visible_to_external', sa.Boolean(), nullable=False),
    sa.Column('competency_id', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['competency_id'], ['competencies.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['rubric_id'], ['rubrics.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_criterion_competency', 'rubric_criteria', ['competency_id'], unique=False)
    op.create_index('ix_criterion_rubric', 'rubric_criteria', ['rubric_id'], unique=False)
    op.create_index(op.f('ix_rubric_criteria_category'), 'rubric_criteria', ['category'], unique=False)
    op.create_index(op.f('ix_rubric_criteria_competency_id'), 'rubric_criteria', ['competency_id'], unique=False)
    op.create_index(op.f('ix_rubric_criteria_id'), 'rubric_criteria', ['id'], unique=False)
    op.create_index(op.f('ix_rubric_criteria_order'), 'rubric_criteria', ['order'], unique=False)
    op.create_index(op.f('ix_rubric_criteria_school_id'), 'rubric_criteria', ['school_id'], unique=False)
    op.create_table('subprojects',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=False),
    sa.Column('client_id', sa.Integer(), nullable=True),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('team_number', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_subproject_client', 'subprojects', ['client_id'], unique=False)
    op.create_index('ix_subproject_project', 'subprojects', ['project_id'], unique=False)
    op.create_index('ix_subproject_school', 'subprojects', ['school_id'], unique=False)
    op.create_index('ix_subproject_team', 'subprojects', ['project_id', 'team_number'], unique=False)
    op.create_index(op.f('ix_subprojects_client_id'), 'subprojects', ['client_id'], unique=False)
    op.create_index(op.f('ix_subprojects_id'), 'subprojects', ['id'], unique=False)
    op.create_index(op.f('ix_subprojects_project_id'), 'subprojects', ['project_id'], unique=False)
    op.create_index(op.f('ix_subprojects_school_id'), 'subprojects', ['school_id'], unique=False)
    op.create_index(op.f('ix_subprojects_team_number'), 'subprojects', ['team_number'], unique=False)
    op.create_table('tasks',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(length=500), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('due_date', sa.Date(), nullable=True),
    sa.Column('status', sa.String(length=30), nullable=False),
    sa.Column('type', sa.String(length=30), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=True),
    sa.Column('client_id', sa.Integer(), nullable=True),
    sa.Column('class_id', sa.Integer(), nullable=True),
    sa.Column('auto_generated', sa.Boolean(), nullable=False),
    sa.Column('source', sa.String(length=50), nullable=False),
    sa.Column('email_to', sa.String(length=500), nullable=True),
    sa.Column('email_cc', sa.String(length=500), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['class_id'], ['classes.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['client_id'], ['clients.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['school_id'], ['schools.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_task_auto_generated', 'tasks', ['auto_generated'], unique=False)
    op.create_index('ix_task_client', 'tasks', ['client_id'], unique=False)
    op.create_index('ix_task_due_date', 'tasks', ['due_date'], unique=False)
    op.create_index('ix_task_project', 'tasks', ['project_id'], unique=False)
    op.create_index('ix_task_school_status', 'tasks', ['school_id', 'status'], unique=False)
    op.create_index('ix_task_status', 'tasks', ['status'], unique=False)
    op.create_index(op.f('ix_tasks_class_id'), 'tasks', ['class_id'], unique=False)
    op.create_index(op.f('ix_tasks_client_id'), 'tasks', ['client_id'], unique=False)
    op.create_index(op.f('ix_tasks_due_date'), 'tasks', ['due_date'], unique=False)
    op.create_index(op.f('ix_tasks_id'), 'tasks', ['id'], unique=False)
    op.create_index(op.f('ix_tasks_project_id'), 'tasks', ['project_id'], unique=False)
    op.create_index(op.f('ix_tasks_school_id'), 'tasks', ['school_id'], unique=False)
    op.create_index(op.f('ix_tasks_status'), 'tasks', ['status'], unique=False)
    op.create_table('assignment_submissions',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('project_assessment_id', sa.Integer(), nullable=False),
    sa.Column('project_team_id', sa.Integer(), nullable=False),
    sa.Column('doc_type', sa.String(length=20), nullable=False),
    sa.Column('url', sa.Text(), nullable=True),
    sa.Column('status', sa.String(length=30), nullable=False),
    sa.Column('version_label', sa.String(length=50), nullable=True),
    sa.Column('submitted_by_user_id', sa.Integer(), nullable=True),
    sa.Column('submitted_at', sa.DateTime(), nullable=True),
    sa.Column('last_checked_by_user_id', sa.Integer(), nullable=True),
    sa.Column('last_checked_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['last_checked_by_user_id'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['project_assessment_id'], ['project_assessments.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['project_team_id'], ['project_teams.id'], ondelete='RESTRICT'),
    sa.ForeignKeyConstraint(['submitted_by_user_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('project_assessment_id', 'project_team_id', 'doc_type', 'version_label', name='uq_submission_per_assessment_team_doctype_version')
    )
    op.create_index(op.f('ix_assignment_submissions_id'), 'assignment_submissions', ['id'], unique=False)
    op.create_index(op.f('ix_assignment_submissions_project_assessment_id'), 'assignment_submissions', ['project_assessment_id'], unique=False)
    op.create_index(op.f('ix_assignment_submissions_project_team_id'), 'assignment_submissions', ['project_team_id'], unique=False)
    op.create_index(op.f('ix_assignment_submissions_school_id'), 'assignment_submissions', ['school_id'], unique=False)
    op.create_index('ix_submissions_assessment', 'assignment_submissions', ['project_assessment_id'], unique=False)
    op.create_index('ix_submissions_school', 'assignment_submissions', ['school_id'], unique=False)
    op.create_index('ix_submissions_status', 'assignment_submissions', ['project_assessment_id', 'status'], unique=False)
    op.create_index('ix_submissions_team', 'assignment_submissions', ['project_team_id'], unique=False)
    op.create_table('competency_external_scores',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('invite_id', sa.Integer(), nullable=False),
    sa.Column('window_id', sa.Integer(), nullable=False),
    sa.Column('subject_user_id', sa.Integer(), nullable=False),
    sa.Column('competency_id', sa.Integer(), nullable=False),
    sa.Column('score', sa.SmallInteger(), nullable=False),
    sa.Column('comment', sa.Text(), nullable=True),
    sa.Column('reviewer_name', sa.String(length=200), nullable=True),
    sa.Column('reviewer_organization', sa.String(length=200), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['competency_id'], ['competencies.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['invite_id'], ['competency_external_invites.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['subject_user_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['window_id'], ['competency_windows.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('invite_id', 'competency_id', name='uq_external_score_per_competency')
    )
    op.create_index(op.f('ix_competency_external_scores_id'), 'competency_external_scores', ['id'], unique=False)
    op.create_index(op.f('ix_competency_external_scores_school_id'), 'competency_external_scores', ['school_id'], unique=False)
    op.create_index('ix_external_score_competency', 'competency_external_scores', ['competency_id'], unique=False)
    op.create_index('ix_external_score_window_subject', 'competency_external_scores', ['window_id', 'subject_user_id'], unique=False)
    op.create_table('competency_reflections',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('window_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('goal_id', sa.Integer(), nullable=False),
    sa.Column('text', sa.Text(), nullable=False),
    sa.Column('goal_achieved', sa.Boolean(), nullable=True),
    sa.Column('evidence', sa.Text(), nullable=True),
    sa.Column('submitted_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['goal_id'], ['competency_goals.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['window_id'], ['competency_windows.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('window_id', 'user_id', 'goal_id', name='uq_competency_reflection_per_goal')
    )
    op.create_index('ix_competency_reflection_window_user', 'competency_reflections', ['window_id', 'user_id'], unique=False)
    op.create_index(op.f('ix_competency_reflections_id'), 'competency_reflections', ['id'], unique=False)
    op.create_index(op.f('ix_competency_reflections_school_id'), 'competency_reflections', ['school_id'], unique=False)
    op.create_table('evaluations',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=True),
    sa.Column('project_id', sa.Integer(), nullable=True),
    sa.Column('project_team_id', sa.Integer(), nullable=True),
    sa.Column('rubric_id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('evaluation_type', sa.String(length=30), nullable=False),
    sa.Column('settings', sa.JSON(), nullable=False),
    sa.Column('status', sa.String(length=30), nullable=False),
    sa.Column('closed_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['project_team_id'], ['project_teams.id'], ondelete='RESTRICT'),
    sa.ForeignKeyConstraint(['rubric_id'], ['rubrics.id'], ondelete='RESTRICT'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_eval_course', 'evaluations', ['course_id'], unique=False)
    op.create_index('ix_eval_project', 'evaluations', ['project_id'], unique=False)
    op.create_index('ix_eval_project_team', 'evaluations', ['project_team_id'], unique=False)
    op.create_index('ix_eval_project_team_status', 'evaluations', ['project_team_id', 'status'], unique=False)
    op.create_index('ix_eval_rubric', 'evaluations', ['rubric_id'], unique=False)
    op.create_index('ix_eval_school_type', 'evaluations', ['school_id', 'evaluation_type'], unique=False)
    op.create_index('ix_eval_status', 'evaluations', ['status'], unique=False)
    op.create_index('ix_eval_type', 'evaluations', ['evaluation_type'], unique=False)
    op.create_index(op.f('ix_evaluations_id'), 'evaluations', ['id'], unique=False)
    op.create_index(op.f('ix_evaluations_project_id'), 'evaluations', ['project_id'], unique=False)
    op.create_index(op.f('ix_evaluations_project_team_id'), 'evaluations', ['project_team_id'], unique=False)
    op.create_index(op.f('ix_evaluations_school_id'), 'evaluations', ['school_id'], unique=False)
    op.create_table('project_assessment_reflections',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('assessment_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('text', sa.Text(), nullable=False),
    sa.Column('word_count', sa.Integer(), nullable=False),
    sa.Column('submitted_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['assessment_id'], ['project_assessments.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('assessment_id', 'user_id', name='uq_project_reflection_once')
    )
    op.create_index(op.f('ix_project_assessment_reflections_id'), 'project_assessment_reflections', ['id'], unique=False)
    op.create_index(op.f('ix_project_assessment_reflections_school_id'), 'project_assessment_reflections', ['school_id'], unique=False)
    op.create_index('ix_project_reflection_assessment', 'project_assessment_reflections', ['assessment_id'], unique=False)
    op.create_table('project_assessment_scores',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('assessment_id', sa.Integer(), nullable=False),
    sa.Column('criterion_id', sa.Integer(), nullable=False),
    sa.Column('team_number', sa.Integer(), nullable=True),
    sa.Column('student_id', sa.Integer(), nullable=True),
    sa.Column('score', sa.SmallInteger(), nullable=False),
    sa.Column('comment', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['assessment_id'], ['project_assessments.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['criterion_id'], ['rubric_criteria.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('assessment_id', 'criterion_id', 'team_number', 'student_id', name='uq_project_score_per_criterion_team_student')
    )
    op.create_index(op.f('ix_project_assessment_scores_id'), 'project_assessment_scores', ['id'], unique=False)
    op.create_index(op.f('ix_project_assessment_scores_school_id'), 'project_assessment_scores', ['school_id'], unique=False)
    op.create_index('ix_project_score_assessment', 'project_assessment_scores', ['assessment_id'], unique=False)
    op.create_index('ix_project_score_student', 'project_assessment_scores', ['assessment_id', 'student_id'], unique=False)
    op.create_index('ix_project_score_team', 'project_assessment_scores', ['assessment_id', 'team_number'], unique=False)
    op.create_table('project_assessment_self_assessments',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('assessment_id', sa.Integer(), nullable=False),
    sa.Column('student_id', sa.Integer(), nullable=False),
    sa.Column('team_number', sa.Integer(), nullable=True),
    sa.Column('locked', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['assessment_id'], ['project_assessments.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('assessment_id', 'student_id', name='uq_self_assessment_once_per_student')
    )
    op.create_index(op.f('ix_project_assessment_self_assessments_id'), 'project_assessment_self_assessments', ['id'], unique=False)
    op.create_index(op.f('ix_project_assessment_self_assessments_school_id'), 'project_assessment_self_assessments', ['school_id'], unique=False)
    op.create_index('ix_self_assessment_assessment', 'project_assessment_self_assessments', ['assessment_id'], unique=False)
    op.create_index('ix_self_assessment_student', 'project_assessment_self_assessments', ['student_id'], unique=False)
    op.create_table('project_assessment_teams',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('project_assessment_id', sa.Integer(), nullable=False),
    sa.Column('project_team_id', sa.Integer(), nullable=False),
    sa.Column('status', sa.String(length=30), nullable=False),
    sa.Column('scores_count', sa.Integer(), nullable=False),
    sa.Column('last_updated_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['project_assessment_id'], ['project_assessments.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['project_team_id'], ['project_teams.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('project_assessment_id', 'project_team_id', name='uq_project_assessment_team_once')
    )
    op.create_index('ix_pat_assessment', 'project_assessment_teams', ['project_assessment_id'], unique=False)
    op.create_index('ix_pat_assessment_status', 'project_assessment_teams', ['project_assessment_id', 'status'], unique=False)
    op.create_index('ix_pat_team', 'project_assessment_teams', ['project_team_id'], unique=False)
    op.create_index(op.f('ix_project_assessment_teams_id'), 'project_assessment_teams', ['id'], unique=False)
    op.create_index(op.f('ix_project_assessment_teams_project_assessment_id'), 'project_assessment_teams', ['project_assessment_id'], unique=False)
    op.create_index(op.f('ix_project_assessment_teams_project_team_id'), 'project_assessment_teams', ['project_team_id'], unique=False)
    op.create_index(op.f('ix_project_assessment_teams_school_id'), 'project_assessment_teams', ['school_id'], unique=False)
    op.create_table('project_team_externals',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('project_team_id', sa.Integer(), nullable=False),
    sa.Column('external_evaluator_id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=True),
    sa.Column('assessment_id', sa.Integer(), nullable=True),
    sa.Column('team_number', sa.Integer(), nullable=True),
    sa.Column('invitation_token', sa.String(length=128), nullable=False),
    sa.Column('token_expires_at', sa.DateTime(), nullable=True),
    sa.Column('status', sa.String(length=30), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('invited_at', sa.DateTime(), nullable=True),
    sa.Column('submitted_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['assessment_id'], ['project_assessments.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['external_evaluator_id'], ['external_evaluators.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['project_team_id'], ['project_teams.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_project_team_external_assessment', 'project_team_externals', ['assessment_id'], unique=False)
    op.create_index('ix_project_team_external_evaluator', 'project_team_externals', ['external_evaluator_id'], unique=False)
    op.create_index('ix_project_team_external_project', 'project_team_externals', ['project_id'], unique=False)
    op.create_index('ix_project_team_external_project_team', 'project_team_externals', ['project_team_id'], unique=False)
    op.create_index('ix_project_team_external_status', 'project_team_externals', ['status'], unique=False)
    op.create_index('ix_project_team_external_team', 'project_team_externals', ['project_team_id', 'team_number'], unique=False)
    op.create_index('ix_project_team_external_token', 'project_team_externals', ['invitation_token'], unique=False)
    op.create_index(op.f('ix_project_team_externals_assessment_id'), 'project_team_externals', ['assessment_id'], unique=False)
    op.create_index(op.f('ix_project_team_externals_external_evaluator_id'), 'project_team_externals', ['external_evaluator_id'], unique=False)
    op.create_index(op.f('ix_project_team_externals_id'), 'project_team_externals', ['id'], unique=False)
    op.create_index(op.f('ix_project_team_externals_invitation_token'), 'project_team_externals', ['invitation_token'], unique=False)
    op.create_index(op.f('ix_project_team_externals_project_id'), 'project_team_externals', ['project_id'], unique=False)
    op.create_index(op.f('ix_project_team_externals_project_team_id'), 'project_team_externals', ['project_team_id'], unique=False)
    op.create_index(op.f('ix_project_team_externals_school_id'), 'project_team_externals', ['school_id'], unique=False)
    op.create_index(op.f('ix_project_team_externals_team_number'), 'project_team_externals', ['team_number'], unique=False)
    op.create_table('project_team_members',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('project_team_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('role', sa.String(length=100), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['project_team_id'], ['project_teams.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('project_team_id', 'user_id', name='uq_project_team_member_once')
    )
    op.create_index('ix_project_team_member_composite', 'project_team_members', ['project_team_id', 'user_id'], unique=False)
    op.create_index('ix_project_team_member_project_team', 'project_team_members', ['project_team_id'], unique=False)
    op.create_index('ix_project_team_member_user', 'project_team_members', ['user_id'], unique=False)
    op.create_index(op.f('ix_project_team_members_id'), 'project_team_members', ['id'], unique=False)
    op.create_index(op.f('ix_project_team_members_project_team_id'), 'project_team_members', ['project_team_id'], unique=False)
    op.create_index(op.f('ix_project_team_members_school_id'), 'project_team_members', ['school_id'], unique=False)
    op.create_index(op.f('ix_project_team_members_user_id'), 'project_team_members', ['user_id'], unique=False)
    op.create_table('rubric_criterion_learning_objectives',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('criterion_id', sa.Integer(), nullable=False),
    sa.Column('learning_objective_id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['criterion_id'], ['rubric_criteria.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['learning_objective_id'], ['learning_objectives.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('criterion_id', 'learning_objective_id', name='uq_criterion_learning_objective')
    )
    op.create_index('ix_criterion_lo_criterion', 'rubric_criterion_learning_objectives', ['criterion_id'], unique=False)
    op.create_index('ix_criterion_lo_objective', 'rubric_criterion_learning_objectives', ['learning_objective_id'], unique=False)
    op.create_index(op.f('ix_rubric_criterion_learning_objectives_id'), 'rubric_criterion_learning_objectives', ['id'], unique=False)
    op.create_index(op.f('ix_rubric_criterion_learning_objectives_school_id'), 'rubric_criterion_learning_objectives', ['school_id'], unique=False)
    op.create_table('allocations',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('evaluation_id', sa.Integer(), nullable=False),
    sa.Column('reviewer_id', sa.Integer(), nullable=False),
    sa.Column('reviewee_id', sa.Integer(), nullable=False),
    sa.Column('is_self', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['evaluation_id'], ['evaluations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['reviewee_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['reviewer_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('evaluation_id', 'reviewer_id', 'reviewee_id', name='uq_allocation_unique')
    )
    op.create_index('ix_alloc_eval_reviewee', 'allocations', ['evaluation_id', 'reviewee_id'], unique=False)
    op.create_index('ix_alloc_eval_reviewer', 'allocations', ['evaluation_id', 'reviewer_id'], unique=False)
    op.create_index(op.f('ix_allocations_id'), 'allocations', ['id'], unique=False)
    op.create_index(op.f('ix_allocations_school_id'), 'allocations', ['school_id'], unique=False)
    op.create_table('feedback_summaries',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('evaluation_id', sa.Integer(), nullable=False),
    sa.Column('student_id', sa.Integer(), nullable=False),
    sa.Column('summary_text', sa.Text(), nullable=False),
    sa.Column('feedback_hash', sa.String(length=64), nullable=False),
    sa.Column('generation_method', sa.String(length=20), nullable=False),
    sa.Column('generation_duration_ms', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['evaluation_id'], ['evaluations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('evaluation_id', 'student_id', name='uq_summary_per_student_eval')
    )
    op.create_index(op.f('ix_feedback_summaries_id'), 'feedback_summaries', ['id'], unique=False)
    op.create_index(op.f('ix_feedback_summaries_school_id'), 'feedback_summaries', ['school_id'], unique=False)
    op.create_index('ix_feedback_summary_eval', 'feedback_summaries', ['evaluation_id'], unique=False)
    op.create_index('ix_feedback_summary_hash', 'feedback_summaries', ['feedback_hash'], unique=False)
    op.create_table('grades',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('evaluation_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('grade', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('meta', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), nullable=False),
    sa.Column('group_grade', sa.Float(), nullable=True),
    sa.Column('gcf', sa.Float(), nullable=True),
    sa.Column('spr', sa.Float(), nullable=True),
    sa.Column('suggested_grade', sa.Float(), nullable=True),
    sa.Column('published_grade', sa.Float(), nullable=True),
    sa.Column('override_reason', sa.Text(), nullable=True),
    sa.Column('published_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['evaluation_id'], ['evaluations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('evaluation_id', 'user_id', name='uq_grade_once')
    )
    op.create_index('ix_grade_eval', 'grades', ['evaluation_id'], unique=False)
    op.create_index(op.f('ix_grades_id'), 'grades', ['id'], unique=False)
    op.create_index(op.f('ix_grades_school_id'), 'grades', ['school_id'], unique=False)
    op.create_table('project_assessment_self_assessment_scores',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('self_assessment_id', sa.Integer(), nullable=False),
    sa.Column('criterion_id', sa.Integer(), nullable=False),
    sa.Column('score', sa.SmallInteger(), nullable=False),
    sa.Column('comment', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['criterion_id'], ['rubric_criteria.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['self_assessment_id'], ['project_assessment_self_assessments.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('self_assessment_id', 'criterion_id', name='uq_self_score_per_criterion')
    )
    op.create_index(op.f('ix_project_assessment_self_assessment_scores_id'), 'project_assessment_self_assessment_scores', ['id'], unique=False)
    op.create_index(op.f('ix_project_assessment_self_assessment_scores_school_id'), 'project_assessment_self_assessment_scores', ['school_id'], unique=False)
    op.create_index('ix_self_score_criterion', 'project_assessment_self_assessment_scores', ['criterion_id'], unique=False)
    op.create_index('ix_self_score_self_assessment', 'project_assessment_self_assessment_scores', ['self_assessment_id'], unique=False)
    op.create_table('project_notes_contexts',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('project_id', sa.Integer(), nullable=True),
    sa.Column('course_id', sa.Integer(), nullable=True),
    sa.Column('class_name', sa.String(length=50), nullable=True),
    sa.Column('evaluation_id', sa.Integer(), nullable=True),
    sa.Column('project_team_id', sa.Integer(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('status', sa.String(length=30), nullable=False),
    sa.Column('closed_at', sa.DateTime(), nullable=True),
    sa.Column('settings', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['evaluation_id'], ['evaluations.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['project_team_id'], ['project_teams.id'], ondelete='RESTRICT'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_project_notes_context_created_by', 'project_notes_contexts', ['created_by'], unique=False)
    op.create_index('ix_project_notes_context_project_team', 'project_notes_contexts', ['project_team_id'], unique=False)
    op.create_index('ix_project_notes_context_school_course', 'project_notes_contexts', ['school_id', 'course_id'], unique=False)
    op.create_index('ix_project_notes_context_status', 'project_notes_contexts', ['status'], unique=False)
    op.create_index(op.f('ix_project_notes_contexts_class_name'), 'project_notes_contexts', ['class_name'], unique=False)
    op.create_index(op.f('ix_project_notes_contexts_course_id'), 'project_notes_contexts', ['course_id'], unique=False)
    op.create_index(op.f('ix_project_notes_contexts_created_by'), 'project_notes_contexts', ['created_by'], unique=False)
    op.create_index(op.f('ix_project_notes_contexts_evaluation_id'), 'project_notes_contexts', ['evaluation_id'], unique=False)
    op.create_index(op.f('ix_project_notes_contexts_id'), 'project_notes_contexts', ['id'], unique=False)
    op.create_index(op.f('ix_project_notes_contexts_project_id'), 'project_notes_contexts', ['project_id'], unique=False)
    op.create_index(op.f('ix_project_notes_contexts_project_team_id'), 'project_notes_contexts', ['project_team_id'], unique=False)
    op.create_index(op.f('ix_project_notes_contexts_school_id'), 'project_notes_contexts', ['school_id'], unique=False)
    op.create_table('published_grades',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('evaluation_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('grade', sa.Float(), nullable=False),
    sa.Column('reason', sa.String(length=255), nullable=True),
    sa.Column('meta', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['evaluation_id'], ['evaluations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('school_id', 'evaluation_id', 'user_id', name='uq_published_grade_once')
    )
    op.create_index(op.f('ix_published_grades_school_id'), 'published_grades', ['school_id'], unique=False)
    op.create_table('reflections',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('evaluation_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('text', sa.Text(), nullable=False),
    sa.Column('word_count', sa.Integer(), nullable=False),
    sa.Column('submitted_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['evaluation_id'], ['evaluations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('evaluation_id', 'user_id', name='uq_one_reflection')
    )
    op.create_index('ix_reflection_eval', 'reflections', ['evaluation_id'], unique=False)
    op.create_index(op.f('ix_reflections_id'), 'reflections', ['id'], unique=False)
    op.create_index(op.f('ix_reflections_school_id'), 'reflections', ['school_id'], unique=False)
    op.create_table('submission_events',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('submission_id', sa.Integer(), nullable=False),
    sa.Column('actor_user_id', sa.Integer(), nullable=True),
    sa.Column('event_type', sa.String(length=50), nullable=False),
    sa.Column('payload', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['actor_user_id'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['submission_id'], ['assignment_submissions.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_submission_events_created', 'submission_events', ['created_at'], unique=False)
    op.create_index(op.f('ix_submission_events_id'), 'submission_events', ['id'], unique=False)
    op.create_index('ix_submission_events_school', 'submission_events', ['school_id'], unique=False)
    op.create_index(op.f('ix_submission_events_school_id'), 'submission_events', ['school_id'], unique=False)
    op.create_index('ix_submission_events_submission', 'submission_events', ['submission_id'], unique=False)
    op.create_index(op.f('ix_submission_events_submission_id'), 'submission_events', ['submission_id'], unique=False)
    op.create_table('summary_generation_jobs',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('evaluation_id', sa.Integer(), nullable=False),
    sa.Column('student_id', sa.Integer(), nullable=False),
    sa.Column('job_id', sa.String(length=200), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('progress', sa.Integer(), nullable=False),
    sa.Column('priority', sa.String(length=20), nullable=False),
    sa.Column('retry_count', sa.Integer(), nullable=False),
    sa.Column('max_retries', sa.Integer(), nullable=False),
    sa.Column('next_retry_at', sa.DateTime(), nullable=True),
    sa.Column('cancelled_at', sa.DateTime(), nullable=True),
    sa.Column('cancelled_by', sa.Integer(), nullable=True),
    sa.Column('webhook_url', sa.String(length=500), nullable=True),
    sa.Column('webhook_delivered', sa.Boolean(), nullable=False),
    sa.Column('webhook_attempts', sa.Integer(), nullable=False),
    sa.Column('queue_name', sa.String(length=100), nullable=False),
    sa.Column('task_type', sa.String(length=100), nullable=False),
    sa.Column('result', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('started_at', sa.DateTime(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['cancelled_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['evaluation_id'], ['evaluations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_summary_generation_jobs_id'), 'summary_generation_jobs', ['id'], unique=False)
    op.create_index(op.f('ix_summary_generation_jobs_job_id'), 'summary_generation_jobs', ['job_id'], unique=True)
    op.create_index(op.f('ix_summary_generation_jobs_school_id'), 'summary_generation_jobs', ['school_id'], unique=False)
    op.create_index('ix_summary_job_created', 'summary_generation_jobs', ['created_at'], unique=False)
    op.create_index('ix_summary_job_eval_student', 'summary_generation_jobs', ['evaluation_id', 'student_id'], unique=False)
    op.create_index('ix_summary_job_next_retry', 'summary_generation_jobs', ['next_retry_at'], unique=False)
    op.create_index('ix_summary_job_priority', 'summary_generation_jobs', ['priority', 'created_at'], unique=False)
    op.create_index('ix_summary_job_queue', 'summary_generation_jobs', ['queue_name'], unique=False)
    op.create_index('ix_summary_job_status', 'summary_generation_jobs', ['status'], unique=False)
    op.create_table('project_notes',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('context_id', sa.Integer(), nullable=False),
    sa.Column('note_type', sa.String(length=20), nullable=False),
    sa.Column('team_id', sa.Integer(), nullable=True),
    sa.Column('student_id', sa.Integer(), nullable=True),
    sa.Column('text', sa.Text(), nullable=False),
    sa.Column('tags', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('omza_category', sa.String(length=100), nullable=True),
    sa.Column('learning_objective_id', sa.Integer(), nullable=True),
    sa.Column('is_competency_evidence', sa.Boolean(), nullable=False),
    sa.Column('is_portfolio_evidence', sa.Boolean(), nullable=False),
    sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('created_by', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['context_id'], ['project_notes_contexts.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['learning_objective_id'], ['learning_objectives.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_project_note_context_type', 'project_notes', ['context_id', 'note_type'], unique=False)
    op.create_index('ix_project_note_created_at', 'project_notes', ['created_at'], unique=False)
    op.create_index('ix_project_note_omza', 'project_notes', ['omza_category'], unique=False)
    op.create_index('ix_project_note_student', 'project_notes', ['student_id'], unique=False)
    op.create_index('ix_project_note_team', 'project_notes', ['team_id'], unique=False)
    op.create_index(op.f('ix_project_notes_context_id'), 'project_notes', ['context_id'], unique=False)
    op.create_index(op.f('ix_project_notes_created_by'), 'project_notes', ['created_by'], unique=False)
    op.create_index(op.f('ix_project_notes_id'), 'project_notes', ['id'], unique=False)
    op.create_index(op.f('ix_project_notes_learning_objective_id'), 'project_notes', ['learning_objective_id'], unique=False)
    op.create_index(op.f('ix_project_notes_student_id'), 'project_notes', ['student_id'], unique=False)
    op.create_index(op.f('ix_project_notes_team_id'), 'project_notes', ['team_id'], unique=False)
    op.create_table('reviewer_ratings',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('allocation_id', sa.Integer(), nullable=False),
    sa.Column('rating', sa.SmallInteger(), nullable=False),
    sa.Column('comment', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['allocation_id'], ['allocations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('allocation_id', name='uq_reviewer_rating_once')
    )
    op.create_index(op.f('ix_reviewer_ratings_id'), 'reviewer_ratings', ['id'], unique=False)
    op.create_index(op.f('ix_reviewer_ratings_school_id'), 'reviewer_ratings', ['school_id'], unique=False)
    op.create_table('scores',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('school_id', sa.Integer(), nullable=False),
    sa.Column('allocation_id', sa.Integer(), nullable=False),
    sa.Column('criterion_id', sa.Integer(), nullable=False),
    sa.Column('score', sa.SmallInteger(), nullable=False),
    sa.Column('comment', sa.Text(), nullable=True),
    sa.Column('attachments', sa.JSON(), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['allocation_id'], ['allocations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['criterion_id'], ['rubric_criteria.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('allocation_id', 'criterion_id', name='uq_one_score_per_criterion')
    )
    op.create_index('ix_score_allocation', 'scores', ['allocation_id'], unique=False)
    op.create_index(op.f('ix_scores_id'), 'scores', ['id'], unique=False)
    op.create_index(op.f('ix_scores_school_id'), 'scores', ['school_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_scores_school_id'), table_name='scores')
    op.drop_index(op.f('ix_scores_id'), table_name='scores')
    op.drop_index('ix_score_allocation', table_name='scores')
    op.drop_table('scores')
    op.drop_index(op.f('ix_reviewer_ratings_school_id'), table_name='reviewer_ratings')
    op.drop_index(op.f('ix_reviewer_ratings_id'), table_name='reviewer_ratings')
    op.drop_table('reviewer_ratings')
    op.drop_index(op.f('ix_project_notes_team_id'), table_name='project_notes')
    op.drop_index(op.f('ix_project_notes_student_id'), table_name='project_notes')
    op.drop_index(op.f('ix_project_notes_learning_objective_id'), table_name='project_notes')
    op.drop_index(op.f('ix_project_notes_id'), table_name='project_notes')
    op.drop_index(op.f('ix_project_notes_created_by'), table_name='project_notes')
    op.drop_index(op.f('ix_project_notes_context_id'), table_name='project_notes')
    op.drop_index('ix_project_note_team', table_name='project_notes')
    op.drop_index('ix_project_note_student', table_name='project_notes')
    op.drop_index('ix_project_note_omza', table_name='project_notes')
    op.drop_index('ix_project_note_created_at', table_name='project_notes')
    op.drop_index('ix_project_note_context_type', table_name='project_notes')
    op.drop_table('project_notes')
    op.drop_index('ix_summary_job_status', table_name='summary_generation_jobs')
    op.drop_index('ix_summary_job_queue', table_name='summary_generation_jobs')
    op.drop_index('ix_summary_job_priority', table_name='summary_generation_jobs')
    op.drop_index('ix_summary_job_next_retry', table_name='summary_generation_jobs')
    op.drop_index('ix_summary_job_eval_student', table_name='summary_generation_jobs')
    op.drop_index('ix_summary_job_created', table_name='summary_generation_jobs')
    op.drop_index(op.f('ix_summary_generation_jobs_school_id'), table_name='summary_generation_jobs')
    op.drop_index(op.f('ix_summary_generation_jobs_job_id'), table_name='summary_generation_jobs')
    op.drop_index(op.f('ix_summary_generation_jobs_id'), table_name='summary_generation_jobs')
    op.drop_table('summary_generation_jobs')
    op.drop_index(op.f('ix_submission_events_submission_id'), table_name='submission_events')
    op.drop_index('ix_submission_events_submission', table_name='submission_events')
    op.drop_index(op.f('ix_submission_events_school_id'), table_name='submission_events')
    op.drop_index('ix_submission_events_school', table_name='submission_events')
    op.drop_index(op.f('ix_submission_events_id'), table_name='submission_events')
    op.drop_index('ix_submission_events_created', table_name='submission_events')
    op.drop_table('submission_events')
    op.drop_index(op.f('ix_reflections_school_id'), table_name='reflections')
    op.drop_index(op.f('ix_reflections_id'), table_name='reflections')
    op.drop_index('ix_reflection_eval', table_name='reflections')
    op.drop_table('reflections')
    op.drop_index(op.f('ix_published_grades_school_id'), table_name='published_grades')
    op.drop_table('published_grades')
    op.drop_index(op.f('ix_project_notes_contexts_school_id'), table_name='project_notes_contexts')
    op.drop_index(op.f('ix_project_notes_contexts_project_team_id'), table_name='project_notes_contexts')
    op.drop_index(op.f('ix_project_notes_contexts_project_id'), table_name='project_notes_contexts')
    op.drop_index(op.f('ix_project_notes_contexts_id'), table_name='project_notes_contexts')
    op.drop_index(op.f('ix_project_notes_contexts_evaluation_id'), table_name='project_notes_contexts')
    op.drop_index(op.f('ix_project_notes_contexts_created_by'), table_name='project_notes_contexts')
    op.drop_index(op.f('ix_project_notes_contexts_course_id'), table_name='project_notes_contexts')
    op.drop_index(op.f('ix_project_notes_contexts_class_name'), table_name='project_notes_contexts')
    op.drop_index('ix_project_notes_context_status', table_name='project_notes_contexts')
    op.drop_index('ix_project_notes_context_school_course', table_name='project_notes_contexts')
    op.drop_index('ix_project_notes_context_project_team', table_name='project_notes_contexts')
    op.drop_index('ix_project_notes_context_created_by', table_name='project_notes_contexts')
    op.drop_table('project_notes_contexts')
    op.drop_index('ix_self_score_self_assessment', table_name='project_assessment_self_assessment_scores')
    op.drop_index('ix_self_score_criterion', table_name='project_assessment_self_assessment_scores')
    op.drop_index(op.f('ix_project_assessment_self_assessment_scores_school_id'), table_name='project_assessment_self_assessment_scores')
    op.drop_index(op.f('ix_project_assessment_self_assessment_scores_id'), table_name='project_assessment_self_assessment_scores')
    op.drop_table('project_assessment_self_assessment_scores')
    op.drop_index(op.f('ix_grades_school_id'), table_name='grades')
    op.drop_index(op.f('ix_grades_id'), table_name='grades')
    op.drop_index('ix_grade_eval', table_name='grades')
    op.drop_table('grades')
    op.drop_index('ix_feedback_summary_hash', table_name='feedback_summaries')
    op.drop_index('ix_feedback_summary_eval', table_name='feedback_summaries')
    op.drop_index(op.f('ix_feedback_summaries_school_id'), table_name='feedback_summaries')
    op.drop_index(op.f('ix_feedback_summaries_id'), table_name='feedback_summaries')
    op.drop_table('feedback_summaries')
    op.drop_index(op.f('ix_allocations_school_id'), table_name='allocations')
    op.drop_index(op.f('ix_allocations_id'), table_name='allocations')
    op.drop_index('ix_alloc_eval_reviewer', table_name='allocations')
    op.drop_index('ix_alloc_eval_reviewee', table_name='allocations')
    op.drop_table('allocations')
    op.drop_index(op.f('ix_rubric_criterion_learning_objectives_school_id'), table_name='rubric_criterion_learning_objectives')
    op.drop_index(op.f('ix_rubric_criterion_learning_objectives_id'), table_name='rubric_criterion_learning_objectives')
    op.drop_index('ix_criterion_lo_objective', table_name='rubric_criterion_learning_objectives')
    op.drop_index('ix_criterion_lo_criterion', table_name='rubric_criterion_learning_objectives')
    op.drop_table('rubric_criterion_learning_objectives')
    op.drop_index(op.f('ix_project_team_members_user_id'), table_name='project_team_members')
    op.drop_index(op.f('ix_project_team_members_school_id'), table_name='project_team_members')
    op.drop_index(op.f('ix_project_team_members_project_team_id'), table_name='project_team_members')
    op.drop_index(op.f('ix_project_team_members_id'), table_name='project_team_members')
    op.drop_index('ix_project_team_member_user', table_name='project_team_members')
    op.drop_index('ix_project_team_member_project_team', table_name='project_team_members')
    op.drop_index('ix_project_team_member_composite', table_name='project_team_members')
    op.drop_table('project_team_members')
    op.drop_index(op.f('ix_project_team_externals_team_number'), table_name='project_team_externals')
    op.drop_index(op.f('ix_project_team_externals_school_id'), table_name='project_team_externals')
    op.drop_index(op.f('ix_project_team_externals_project_team_id'), table_name='project_team_externals')
    op.drop_index(op.f('ix_project_team_externals_project_id'), table_name='project_team_externals')
    op.drop_index(op.f('ix_project_team_externals_invitation_token'), table_name='project_team_externals')
    op.drop_index(op.f('ix_project_team_externals_id'), table_name='project_team_externals')
    op.drop_index(op.f('ix_project_team_externals_external_evaluator_id'), table_name='project_team_externals')
    op.drop_index(op.f('ix_project_team_externals_assessment_id'), table_name='project_team_externals')
    op.drop_index('ix_project_team_external_token', table_name='project_team_externals')
    op.drop_index('ix_project_team_external_team', table_name='project_team_externals')
    op.drop_index('ix_project_team_external_status', table_name='project_team_externals')
    op.drop_index('ix_project_team_external_project_team', table_name='project_team_externals')
    op.drop_index('ix_project_team_external_project', table_name='project_team_externals')
    op.drop_index('ix_project_team_external_evaluator', table_name='project_team_externals')
    op.drop_index('ix_project_team_external_assessment', table_name='project_team_externals')
    op.drop_table('project_team_externals')
    op.drop_index(op.f('ix_project_assessment_teams_school_id'), table_name='project_assessment_teams')
    op.drop_index(op.f('ix_project_assessment_teams_project_team_id'), table_name='project_assessment_teams')
    op.drop_index(op.f('ix_project_assessment_teams_project_assessment_id'), table_name='project_assessment_teams')
    op.drop_index(op.f('ix_project_assessment_teams_id'), table_name='project_assessment_teams')
    op.drop_index('ix_pat_team', table_name='project_assessment_teams')
    op.drop_index('ix_pat_assessment_status', table_name='project_assessment_teams')
    op.drop_index('ix_pat_assessment', table_name='project_assessment_teams')
    op.drop_table('project_assessment_teams')
    op.drop_index('ix_self_assessment_student', table_name='project_assessment_self_assessments')
    op.drop_index('ix_self_assessment_assessment', table_name='project_assessment_self_assessments')
    op.drop_index(op.f('ix_project_assessment_self_assessments_school_id'), table_name='project_assessment_self_assessments')
    op.drop_index(op.f('ix_project_assessment_self_assessments_id'), table_name='project_assessment_self_assessments')
    op.drop_table('project_assessment_self_assessments')
    op.drop_index('ix_project_score_team', table_name='project_assessment_scores')
    op.drop_index('ix_project_score_student', table_name='project_assessment_scores')
    op.drop_index('ix_project_score_assessment', table_name='project_assessment_scores')
    op.drop_index(op.f('ix_project_assessment_scores_school_id'), table_name='project_assessment_scores')
    op.drop_index(op.f('ix_project_assessment_scores_id'), table_name='project_assessment_scores')
    op.drop_table('project_assessment_scores')
    op.drop_index('ix_project_reflection_assessment', table_name='project_assessment_reflections')
    op.drop_index(op.f('ix_project_assessment_reflections_school_id'), table_name='project_assessment_reflections')
    op.drop_index(op.f('ix_project_assessment_reflections_id'), table_name='project_assessment_reflections')
    op.drop_table('project_assessment_reflections')
    op.drop_index(op.f('ix_evaluations_school_id'), table_name='evaluations')
    op.drop_index(op.f('ix_evaluations_project_team_id'), table_name='evaluations')
    op.drop_index(op.f('ix_evaluations_project_id'), table_name='evaluations')
    op.drop_index(op.f('ix_evaluations_id'), table_name='evaluations')
    op.drop_index('ix_eval_type', table_name='evaluations')
    op.drop_index('ix_eval_status', table_name='evaluations')
    op.drop_index('ix_eval_school_type', table_name='evaluations')
    op.drop_index('ix_eval_rubric', table_name='evaluations')
    op.drop_index('ix_eval_project_team_status', table_name='evaluations')
    op.drop_index('ix_eval_project_team', table_name='evaluations')
    op.drop_index('ix_eval_project', table_name='evaluations')
    op.drop_index('ix_eval_course', table_name='evaluations')
    op.drop_table('evaluations')
    op.drop_index(op.f('ix_competency_reflections_school_id'), table_name='competency_reflections')
    op.drop_index(op.f('ix_competency_reflections_id'), table_name='competency_reflections')
    op.drop_index('ix_competency_reflection_window_user', table_name='competency_reflections')
    op.drop_table('competency_reflections')
    op.drop_index('ix_external_score_window_subject', table_name='competency_external_scores')
    op.drop_index('ix_external_score_competency', table_name='competency_external_scores')
    op.drop_index(op.f('ix_competency_external_scores_school_id'), table_name='competency_external_scores')
    op.drop_index(op.f('ix_competency_external_scores_id'), table_name='competency_external_scores')
    op.drop_table('competency_external_scores')
    op.drop_index('ix_submissions_team', table_name='assignment_submissions')
    op.drop_index('ix_submissions_status', table_name='assignment_submissions')
    op.drop_index('ix_submissions_school', table_name='assignment_submissions')
    op.drop_index('ix_submissions_assessment', table_name='assignment_submissions')
    op.drop_index(op.f('ix_assignment_submissions_school_id'), table_name='assignment_submissions')
    op.drop_index(op.f('ix_assignment_submissions_project_team_id'), table_name='assignment_submissions')
    op.drop_index(op.f('ix_assignment_submissions_project_assessment_id'), table_name='assignment_submissions')
    op.drop_index(op.f('ix_assignment_submissions_id'), table_name='assignment_submissions')
    op.drop_table('assignment_submissions')
    op.drop_index(op.f('ix_tasks_status'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_school_id'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_project_id'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_id'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_due_date'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_client_id'), table_name='tasks')
    op.drop_index(op.f('ix_tasks_class_id'), table_name='tasks')
    op.drop_index('ix_task_status', table_name='tasks')
    op.drop_index('ix_task_school_status', table_name='tasks')
    op.drop_index('ix_task_project', table_name='tasks')
    op.drop_index('ix_task_due_date', table_name='tasks')
    op.drop_index('ix_task_client', table_name='tasks')
    op.drop_index('ix_task_auto_generated', table_name='tasks')
    op.drop_table('tasks')
    op.drop_index(op.f('ix_subprojects_team_number'), table_name='subprojects')
    op.drop_index(op.f('ix_subprojects_school_id'), table_name='subprojects')
    op.drop_index(op.f('ix_subprojects_project_id'), table_name='subprojects')
    op.drop_index(op.f('ix_subprojects_id'), table_name='subprojects')
    op.drop_index(op.f('ix_subprojects_client_id'), table_name='subprojects')
    op.drop_index('ix_subproject_team', table_name='subprojects')
    op.drop_index('ix_subproject_school', table_name='subprojects')
    op.drop_index('ix_subproject_project', table_name='subprojects')
    op.drop_index('ix_subproject_client', table_name='subprojects')
    op.drop_table('subprojects')
    op.drop_index(op.f('ix_rubric_criteria_school_id'), table_name='rubric_criteria')
    op.drop_index(op.f('ix_rubric_criteria_order'), table_name='rubric_criteria')
    op.drop_index(op.f('ix_rubric_criteria_id'), table_name='rubric_criteria')
    op.drop_index(op.f('ix_rubric_criteria_competency_id'), table_name='rubric_criteria')
    op.drop_index(op.f('ix_rubric_criteria_category'), table_name='rubric_criteria')
    op.drop_index('ix_criterion_rubric', table_name='rubric_criteria')
    op.drop_index('ix_criterion_competency', table_name='rubric_criteria')
    op.drop_table('rubric_criteria')
    op.drop_index(op.f('ix_project_teams_team_number'), table_name='project_teams')
    op.drop_index(op.f('ix_project_teams_school_id'), table_name='project_teams')
    op.drop_index('ix_project_teams_project_team_number', table_name='project_teams')
    op.drop_index(op.f('ix_project_teams_project_id'), table_name='project_teams')
    op.drop_index(op.f('ix_project_teams_id'), table_name='project_teams')
    op.drop_index('ix_project_team_project', table_name='project_teams')
    op.drop_table('project_teams')
    op.drop_index(op.f('ix_project_assessments_school_id'), table_name='project_assessments')
    op.drop_index(op.f('ix_project_assessments_project_id'), table_name='project_assessments')
    op.drop_index(op.f('ix_project_assessments_id'), table_name='project_assessments')
    op.drop_index('ix_project_assessment_teacher', table_name='project_assessments')
    op.drop_index('ix_project_assessment_status', table_name='project_assessments')
    op.drop_index('ix_project_assessment_role', table_name='project_assessments')
    op.drop_index('ix_project_assessment_project_status', table_name='project_assessments')
    op.drop_index('ix_project_assessment_project_id', table_name='project_assessments')
    op.drop_index('ix_project_assessment_external', table_name='project_assessments')
    op.drop_table('project_assessments')
    op.drop_index('ix_teacher_obs_window_user', table_name='competency_teacher_observations')
    op.drop_index(op.f('ix_competency_teacher_observations_school_id'), table_name='competency_teacher_observations')
    op.drop_index(op.f('ix_competency_teacher_observations_id'), table_name='competency_teacher_observations')
    op.drop_table('competency_teacher_observations')
    op.drop_index('ix_self_score_window_user', table_name='competency_self_scores')
    op.drop_index(op.f('ix_competency_self_scores_school_id'), table_name='competency_self_scores')
    op.drop_index(op.f('ix_competency_self_scores_id'), table_name='competency_self_scores')
    op.drop_table('competency_self_scores')
    op.drop_index('ix_rubric_level_competency', table_name='competency_rubric_levels')
    op.drop_index(op.f('ix_competency_rubric_levels_school_id'), table_name='competency_rubric_levels')
    op.drop_index(op.f('ix_competency_rubric_levels_id'), table_name='competency_rubric_levels')
    op.drop_table('competency_rubric_levels')
    op.drop_index('ix_peer_label_window_to', table_name='competency_peer_labels')
    op.drop_index('ix_peer_label_competency', table_name='competency_peer_labels')
    op.drop_index(op.f('ix_competency_peer_labels_school_id'), table_name='competency_peer_labels')
    op.drop_index(op.f('ix_competency_peer_labels_id'), table_name='competency_peer_labels')
    op.drop_table('competency_peer_labels')
    op.drop_index(op.f('ix_competency_goals_school_id'), table_name='competency_goals')
    op.drop_index(op.f('ix_competency_goals_id'), table_name='competency_goals')
    op.drop_index('ix_competency_goal_window_user', table_name='competency_goals')
    op.drop_table('competency_goals')
    op.drop_index('ix_external_invite_window_subject', table_name='competency_external_invites')
    op.drop_index('ix_external_invite_window', table_name='competency_external_invites')
    op.drop_index('ix_external_invite_subject', table_name='competency_external_invites')
    op.drop_index('ix_external_invite_status', table_name='competency_external_invites')
    op.drop_index(op.f('ix_competency_external_invites_token_hash'), table_name='competency_external_invites')
    op.drop_index(op.f('ix_competency_external_invites_school_id'), table_name='competency_external_invites')
    op.drop_index(op.f('ix_competency_external_invites_id'), table_name='competency_external_invites')
    op.drop_table('competency_external_invites')
    op.drop_index('ix_client_project_project', table_name='client_project_links')
    op.drop_index(op.f('ix_client_project_links_project_id'), table_name='client_project_links')
    op.drop_index(op.f('ix_client_project_links_id'), table_name='client_project_links')
    op.drop_index(op.f('ix_client_project_links_client_id'), table_name='client_project_links')
    op.drop_index('ix_client_project_client', table_name='client_project_links')
    op.drop_table('client_project_links')
    op.drop_index(op.f('ix_attendance_events_user_id'), table_name='attendance_events')
    op.drop_index(op.f('ix_attendance_events_project_id'), table_name='attendance_events')
    op.drop_index('ix_attendance_events_open_sessions', table_name='attendance_events', postgresql_where=sa.text('check_out IS NULL'))
    op.drop_index(op.f('ix_attendance_events_id'), table_name='attendance_events')
    op.drop_index('ix_attendance_events_external_pending', table_name='attendance_events', postgresql_where=sa.text("is_external = true AND approval_status = 'pending'"))
    op.drop_index('ix_attendance_events_check_in', table_name='attendance_events')
    op.drop_table('attendance_events')
    op.drop_index(op.f('ix_template_tag_links_tag_id'), table_name='template_tag_links')
    op.drop_index(op.f('ix_template_tag_links_school_id'), table_name='template_tag_links')
    op.drop_index(op.f('ix_template_tag_links_id'), table_name='template_tag_links')
    op.drop_index('ix_template_tag_link_target', table_name='template_tag_links')
    op.drop_index('ix_template_tag_link_tag', table_name='template_tag_links')
    op.drop_table('template_tag_links')
    op.drop_index(op.f('ix_teacher_courses_school_id'), table_name='teacher_courses')
    op.drop_index(op.f('ix_teacher_courses_id'), table_name='teacher_courses')
    op.drop_index('ix_teacher_course_teacher', table_name='teacher_courses')
    op.drop_index('ix_teacher_course_school', table_name='teacher_courses')
    op.drop_index('ix_teacher_course_course', table_name='teacher_courses')
    op.drop_table('teacher_courses')
    op.drop_index(op.f('ix_student_class_memberships_student_id'), table_name='student_class_memberships')
    op.drop_index(op.f('ix_student_class_memberships_id'), table_name='student_class_memberships')
    op.drop_index(op.f('ix_student_class_memberships_class_id'), table_name='student_class_memberships')
    op.drop_index(op.f('ix_student_class_memberships_academic_year_id'), table_name='student_class_memberships')
    op.drop_index('ix_student_class_membership_student', table_name='student_class_memberships')
    op.drop_index('ix_student_class_membership_class', table_name='student_class_memberships')
    op.drop_index('ix_student_class_membership_academic_year', table_name='student_class_memberships')
    op.drop_table('student_class_memberships')
    op.drop_index(op.f('ix_projects_school_id'), table_name='projects')
    op.drop_index(op.f('ix_projects_id'), table_name='projects')
    op.drop_index(op.f('ix_projects_course_id'), table_name='projects')
    op.drop_index('ix_project_status', table_name='projects')
    op.drop_index('ix_project_school_course', table_name='projects')
    op.drop_index('ix_project_school', table_name='projects')
    op.drop_index('ix_project_course_period', table_name='projects')
    op.drop_index('ix_project_course', table_name='projects')
    op.drop_table('projects')
    op.drop_index(op.f('ix_project_rubric_criterion_templates_school_id'), table_name='project_rubric_criterion_templates')
    op.drop_index(op.f('ix_project_rubric_criterion_templates_rubric_template_id'), table_name='project_rubric_criterion_templates')
    op.drop_index(op.f('ix_project_rubric_criterion_templates_id'), table_name='project_rubric_criterion_templates')
    op.drop_index('ix_project_criterion_template_rubric', table_name='project_rubric_criterion_templates')
    op.drop_index('ix_project_criterion_template_category', table_name='project_rubric_criterion_templates')
    op.drop_table('project_rubric_criterion_templates')
    op.drop_index(op.f('ix_learning_objectives_teacher_id'), table_name='learning_objectives')
    op.drop_index(op.f('ix_learning_objectives_subject_id'), table_name='learning_objectives')
    op.drop_index(op.f('ix_learning_objectives_school_id'), table_name='learning_objectives')
    op.drop_index(op.f('ix_learning_objectives_id'), table_name='learning_objectives')
    op.drop_index(op.f('ix_learning_objectives_course_id'), table_name='learning_objectives')
    op.drop_index('ix_learning_objective_teacher', table_name='learning_objectives')
    op.drop_index('ix_learning_objective_subject', table_name='learning_objectives')
    op.drop_index('ix_learning_objective_school', table_name='learning_objectives')
    op.drop_index('ix_learning_objective_phase', table_name='learning_objectives')
    op.drop_index('ix_learning_objective_is_template', table_name='learning_objectives')
    op.drop_index('ix_learning_objective_domain', table_name='learning_objectives')
    op.drop_index('ix_learning_objective_course', table_name='learning_objectives')
    op.drop_table('learning_objectives')
    op.drop_index(op.f('ix_course_enrollments_student_id'), table_name='course_enrollments')
    op.drop_index(op.f('ix_course_enrollments_id'), table_name='course_enrollments')
    op.drop_index(op.f('ix_course_enrollments_course_id'), table_name='course_enrollments')
    op.drop_index('ix_course_enrollment_student', table_name='course_enrollments')
    op.drop_index('ix_course_enrollment_course', table_name='course_enrollments')
    op.drop_table('course_enrollments')
    op.drop_index(op.f('ix_competency_windows_school_id'), table_name='competency_windows')
    op.drop_index(op.f('ix_competency_windows_id'), table_name='competency_windows')
    op.drop_index('ix_competency_window_status', table_name='competency_windows')
    op.drop_index('ix_competency_window_school', table_name='competency_windows')
    op.drop_table('competency_windows')
    op.drop_index('ix_competency_reflection_template_competency', table_name='competency_reflection_question_templates')
    op.drop_index(op.f('ix_competency_reflection_question_templates_school_id'), table_name='competency_reflection_question_templates')
    op.drop_index(op.f('ix_competency_reflection_question_templates_id'), table_name='competency_reflection_question_templates')
    op.drop_index(op.f('ix_competency_reflection_question_templates_competency_template_id'), table_name='competency_reflection_question_templates')
    op.drop_table('competency_reflection_question_templates')
    op.drop_index('ix_competency_level_template_competency', table_name='competency_level_descriptor_templates')
    op.drop_index(op.f('ix_competency_level_descriptor_templates_school_id'), table_name='competency_level_descriptor_templates')
    op.drop_index(op.f('ix_competency_level_descriptor_templates_id'), table_name='competency_level_descriptor_templates')
    op.drop_index(op.f('ix_competency_level_descriptor_templates_competency_template_id'), table_name='competency_level_descriptor_templates')
    op.drop_table('competency_level_descriptor_templates')
    op.drop_index('ix_competency_teacher', table_name='competencies')
    op.drop_index('ix_competency_subject', table_name='competencies')
    op.drop_index('ix_competency_school', table_name='competencies')
    op.drop_index('ix_competency_is_template', table_name='competencies')
    op.drop_index('ix_competency_course', table_name='competencies')
    op.drop_index('ix_competency_category_id', table_name='competencies')
    op.drop_index(op.f('ix_competencies_teacher_id'), table_name='competencies')
    op.drop_index(op.f('ix_competencies_subject_id'), table_name='competencies')
    op.drop_index(op.f('ix_competencies_school_id'), table_name='competencies')
    op.drop_index(op.f('ix_competencies_phase'), table_name='competencies')
    op.drop_index(op.f('ix_competencies_id'), table_name='competencies')
    op.drop_index(op.f('ix_competencies_course_id'), table_name='competencies')
    op.drop_index(op.f('ix_competencies_category_id'), table_name='competencies')
    op.drop_table('competencies')
    op.drop_index(op.f('ix_template_tags_subject_id'), table_name='template_tags')
    op.drop_index(op.f('ix_template_tags_school_id'), table_name='template_tags')
    op.drop_index(op.f('ix_template_tags_id'), table_name='template_tags')
    op.drop_index('ix_template_tag_subject', table_name='template_tags')
    op.drop_index('ix_template_tag_school', table_name='template_tags')
    op.drop_table('template_tags')
    op.drop_index(op.f('ix_standard_remarks_subject_id'), table_name='standard_remarks')
    op.drop_index(op.f('ix_standard_remarks_school_id'), table_name='standard_remarks')
    op.drop_index(op.f('ix_standard_remarks_id'), table_name='standard_remarks')
    op.drop_index('ix_standard_remark_type', table_name='standard_remarks')
    op.drop_index('ix_standard_remark_subject', table_name='standard_remarks')
    op.drop_index('ix_standard_remark_school', table_name='standard_remarks')
    op.drop_index('ix_standard_remark_category', table_name='standard_remarks')
    op.drop_table('standard_remarks')
    op.drop_index(op.f('ix_scheduled_jobs_school_id'), table_name='scheduled_jobs')
    op.drop_index('ix_scheduled_jobs_next_run', table_name='scheduled_jobs')
    op.drop_index(op.f('ix_scheduled_jobs_id'), table_name='scheduled_jobs')
    op.drop_index('ix_scheduled_jobs_enabled', table_name='scheduled_jobs')
    op.drop_table('scheduled_jobs')
    op.drop_index('ix_rfid_cards_user_id', table_name='rfid_cards')
    op.drop_index('ix_rfid_cards_uid_active', table_name='rfid_cards', postgresql_where=sa.text('is_active = true'))
    op.drop_index(op.f('ix_rfid_cards_id'), table_name='rfid_cards')
    op.drop_table('rfid_cards')
    op.drop_index(op.f('ix_project_rubric_templates_subject_id'), table_name='project_rubric_templates')
    op.drop_index(op.f('ix_project_rubric_templates_school_id'), table_name='project_rubric_templates')
    op.drop_index(op.f('ix_project_rubric_templates_id'), table_name='project_rubric_templates')
    op.drop_index('ix_project_rubric_template_subject', table_name='project_rubric_templates')
    op.drop_index('ix_project_rubric_template_school', table_name='project_rubric_templates')
    op.drop_index('ix_project_rubric_template_level', table_name='project_rubric_templates')
    op.drop_table('project_rubric_templates')
    op.drop_index(op.f('ix_project_assessment_criterion_templates_target_level'), table_name='project_assessment_criterion_templates')
    op.drop_index(op.f('ix_project_assessment_criterion_templates_subject_id'), table_name='project_assessment_criterion_templates')
    op.drop_index(op.f('ix_project_assessment_criterion_templates_school_id'), table_name='project_assessment_criterion_templates')
    op.drop_index(op.f('ix_project_assessment_criterion_templates_id'), table_name='project_assessment_criterion_templates')
    op.drop_index('ix_project_assessment_criterion_template_target_level', table_name='project_assessment_criterion_templates')
    op.drop_index('ix_project_assessment_criterion_template_subject', table_name='project_assessment_criterion_templates')
    op.drop_index('ix_project_assessment_criterion_template_school', table_name='project_assessment_criterion_templates')
    op.drop_index('ix_project_assessment_criterion_template_category', table_name='project_assessment_criterion_templates')
    op.drop_table('project_assessment_criterion_templates')
    op.drop_index(op.f('ix_peer_evaluation_criterion_templates_target_level'), table_name='peer_evaluation_criterion_templates')
    op.drop_index(op.f('ix_peer_evaluation_criterion_templates_subject_id'), table_name='peer_evaluation_criterion_templates')
    op.drop_index(op.f('ix_peer_evaluation_criterion_templates_school_id'), table_name='peer_evaluation_criterion_templates')
    op.drop_index(op.f('ix_peer_evaluation_criterion_templates_id'), table_name='peer_evaluation_criterion_templates')
    op.drop_index('ix_peer_criterion_template_target_level', table_name='peer_evaluation_criterion_templates')
    op.drop_index('ix_peer_criterion_template_subject', table_name='peer_evaluation_criterion_templates')
    op.drop_index('ix_peer_criterion_template_school', table_name='peer_evaluation_criterion_templates')
    op.drop_index('ix_peer_criterion_template_category', table_name='peer_evaluation_criterion_templates')
    op.drop_table('peer_evaluation_criterion_templates')
    op.drop_index(op.f('ix_notifications_school_id'), table_name='notifications')
    op.drop_index('ix_notifications_school', table_name='notifications')
    op.drop_index(op.f('ix_notifications_recipient_user_id'), table_name='notifications')
    op.drop_index('ix_notifications_recipient', table_name='notifications')
    op.drop_index(op.f('ix_notifications_id'), table_name='notifications')
    op.drop_index('ix_notifications_created', table_name='notifications')
    op.drop_table('notifications')
    op.drop_index(op.f('ix_mail_templates_subject_id'), table_name='mail_templates')
    op.drop_index(op.f('ix_mail_templates_school_id'), table_name='mail_templates')
    op.drop_index(op.f('ix_mail_templates_id'), table_name='mail_templates')
    op.drop_index('ix_mail_template_type', table_name='mail_templates')
    op.drop_index('ix_mail_template_subject', table_name='mail_templates')
    op.drop_index('ix_mail_template_school', table_name='mail_templates')
    op.drop_index('ix_mail_template_active', table_name='mail_templates')
    op.drop_table('mail_templates')
    op.drop_index(op.f('ix_courses_subject_id'), table_name='courses')
    op.drop_index(op.f('ix_courses_school_id'), table_name='courses')
    op.drop_index(op.f('ix_courses_id'), table_name='courses')
    op.drop_index(op.f('ix_courses_academic_year_id'), table_name='courses')
    op.drop_index('ix_course_subject', table_name='courses')
    op.drop_index('ix_course_school_active', table_name='courses')
    op.drop_index('ix_course_academic_year', table_name='courses')
    op.drop_table('courses')
    op.drop_index(op.f('ix_competency_templates_subject_id'), table_name='competency_templates')
    op.drop_index(op.f('ix_competency_templates_school_id'), table_name='competency_templates')
    op.drop_index(op.f('ix_competency_templates_id'), table_name='competency_templates')
    op.drop_index('ix_competency_template_subject', table_name='competency_templates')
    op.drop_index('ix_competency_template_school', table_name='competency_templates')
    op.drop_table('competency_templates')
    op.drop_index(op.f('ix_client_logs_id'), table_name='client_logs')
    op.drop_index(op.f('ix_client_logs_client_id'), table_name='client_logs')
    op.drop_index(op.f('ix_client_logs_author_id'), table_name='client_logs')
    op.drop_index('ix_client_log_created_at', table_name='client_logs')
    op.drop_index('ix_client_log_client', table_name='client_logs')
    op.drop_table('client_logs')
    op.drop_index(op.f('ix_classes_school_id'), table_name='classes')
    op.drop_index(op.f('ix_classes_id'), table_name='classes')
    op.drop_index(op.f('ix_classes_academic_year_id'), table_name='classes')
    op.drop_index('ix_class_school', table_name='classes')
    op.drop_index('ix_class_academic_year', table_name='classes')
    op.drop_table('classes')
    op.drop_index(op.f('ix_audit_logs_school_id'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_id'), table_name='audit_logs')
    op.drop_index('ix_audit_log_user', table_name='audit_logs')
    op.drop_index('ix_audit_log_school', table_name='audit_logs')
    op.drop_index('ix_audit_log_entity', table_name='audit_logs')
    op.drop_index('ix_audit_log_created', table_name='audit_logs')
    op.drop_index('ix_audit_log_action', table_name='audit_logs')
    op.drop_table('audit_logs')
    op.drop_index('ix_attendance_aggregates_user_id', table_name='attendance_aggregates')
    op.drop_index(op.f('ix_attendance_aggregates_id'), table_name='attendance_aggregates')
    op.drop_table('attendance_aggregates')
    op.drop_index(op.f('ix_users_team_number'), table_name='users')
    op.drop_index(op.f('ix_users_school_id'), table_name='users')
    op.drop_index(op.f('ix_users_id'), table_name='users')
    op.drop_index(op.f('ix_users_class_name'), table_name='users')
    op.drop_index('ix_user_role_school', table_name='users')
    op.drop_table('users')
    op.drop_index(op.f('ix_subjects_school_id'), table_name='subjects')
    op.drop_index(op.f('ix_subjects_id'), table_name='subjects')
    op.drop_index('ix_subject_school_active', table_name='subjects')
    op.drop_table('subjects')
    op.drop_index(op.f('ix_external_evaluators_school_id'), table_name='external_evaluators')
    op.drop_index(op.f('ix_external_evaluators_id'), table_name='external_evaluators')
    op.drop_index('ix_external_evaluator_school_email', table_name='external_evaluators')
    op.drop_index('ix_external_evaluator_email', table_name='external_evaluators')
    op.drop_table('external_evaluators')
    op.drop_index(op.f('ix_clients_school_id'), table_name='clients')
    op.drop_index(op.f('ix_clients_id'), table_name='clients')
    op.drop_index('ix_client_school_active', table_name='clients')
    op.drop_index('ix_client_organization', table_name='clients')
    op.drop_table('clients')
    op.drop_index(op.f('ix_academic_years_school_id'), table_name='academic_years')
    op.drop_index(op.f('ix_academic_years_id'), table_name='academic_years')
    op.drop_index('ix_academic_year_school', table_name='academic_years')
    op.drop_table('academic_years')
    op.drop_index(op.f('ix_schools_id'), table_name='schools')
    op.drop_table('schools')
    op.drop_index(op.f('ix_rubrics_school_id'), table_name='rubrics')
    op.drop_index(op.f('ix_rubrics_id'), table_name='rubrics')
    op.drop_index('ix_rubric_school_scope', table_name='rubrics')
    op.drop_table('rubrics')
    op.drop_index('ix_competency_category_school', table_name='competency_categories')
    op.drop_index(op.f('ix_competency_categories_school_id'), table_name='competency_categories')
    op.drop_index(op.f('ix_competency_categories_id'), table_name='competency_categories')
    op.drop_table('competency_categories')
    # ### end Alembic commands ###
